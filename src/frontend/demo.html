<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBS | Demo Interativa - Teste Real do Sistema IA</title>
    <meta name="description" content="Teste o sistema UBS na pr√°tica. Crie seu tenant de demonstra√ß√£o e converse com nossa IA especializada em tempo real.">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2D5A9B;
            --primary-light: #4A7BC8;
            --primary-dark: #1E3F6B;
            --secondary-color: #F8F9FA;
            --accent-color: #28A745;
            --whatsapp-green: #25D366;
            --whatsapp-dark: #128C7E;
            --text-dark: #2C3E50;
            --text-light: #6C757D;
            --border-color: #E9ECEF;
            --shadow: 0 4px 20px rgba(45, 90, 155, 0.15);
            --shadow-lg: 0 10px 40px rgba(45, 90, 155, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--secondary-color) 0%, #ffffff 100%);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            box-shadow: var(--shadow);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-image {
            width: 240px;
            height: 120px;
            border-radius: 8px;
            object-fit: contain;
        }

        /* Responsivo para logo */
        @media (max-width: 992px) {
            .logo-image {
                width: 200px;
                height: 100px;
            }
        }

        @media (max-width: 768px) {
            .logo-image {
                width: 160px;
                height: 80px;
            }
        }

        @media (max-width: 480px) {
            .logo-image {
                width: 120px;
                height: 60px;
            }
        }

        .brand-text {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color);
            margin: 0;
        }

        /* Responsivo para texto da marca */
        @media (max-width: 768px) {
            .brand-text {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .brand-text {
                font-size: 1rem;
            }
        }

        .demo-badge {
            background: linear-gradient(135deg, var(--whatsapp-green), var(--whatsapp-dark));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: auto;
        }

        /* Responsivo para badge */
        @media (max-width: 768px) {
            .demo-badge {
                font-size: 0.75rem;
                padding: 0.4rem 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .demo-badge {
                font-size: 0.7rem;
                padding: 0.3rem 0.6rem;
            }
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 140px);
        }

        /* Responsivo para container principal */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 350px 1fr;
                gap: 1.5rem;
            }
        }

        /* Signup Form */
        .signup-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        /* Responsivo para signup section */
        @media (max-width: 992px) {
            .signup-section {
                padding: 1.5rem;
                position: static;
            }
        }

        @media (max-width: 768px) {
            .signup-section {
                padding: 1rem;
                border-radius: 12px;
            }
        }

        .signup-section h2 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .signup-section .subtitle {
            color: var(--text-light);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-control {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(45, 90, 155, 0.25);
            outline: none;
        }

        .domain-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        /* Responsivo para domain selector - alinhado com layout principal */
        @media (max-width: 992px) {
            .domain-selector {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .domain-selector {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .domain-selector {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }

        .domain-option {
            background: var(--secondary-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Responsivo para domain options - melhor alinhamento */
        @media (max-width: 992px) {
            .domain-option {
                padding: 0.875rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .domain-option {
                padding: 1rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .domain-option {
                padding: 1rem;
                font-size: 0.9rem;
            }
            
            .domain-option i {
                font-size: 1rem;
            }
        }

        .domain-option:hover {
            border-color: var(--primary-light);
            background: rgba(74, 123, 200, 0.1);
        }

        .domain-option.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .domain-option i {
            font-size: 1.2rem;
            margin: 0;
            flex-shrink: 0;
        }

        .btn-create-demo {
            background: linear-gradient(135deg, var(--whatsapp-green), var(--whatsapp-dark));
            border: none;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .btn-create-demo:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            color: white;
        }

        .btn-create-demo:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .demo-info {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.9rem;
        }

        .demo-info i {
            color: var(--accent-color);
            margin-right: 0.5rem;
        }

        /* Chat Section */
        .chat-section {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 160px);
            max-height: 800px;
        }

        /* Responsivo para chat section */
        @media (max-width: 768px) {
            .chat-section {
                height: 600px;
                max-height: 600px;
                border-radius: 12px;
            }
        }

        @media (max-width: 480px) {
            .chat-section {
                height: 500px;
                max-height: 500px;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, var(--whatsapp-green), var(--whatsapp-dark));
            color: white;
            padding: 1.5rem;
            border-radius: 16px 16px 0 0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Responsivo para chat header */
        @media (max-width: 768px) {
            .chat-header {
                padding: 1rem;
                border-radius: 12px 12px 0 0;
            }
        }

        @media (max-width: 480px) {
            .chat-header {
                padding: 0.75rem;
                gap: 0.75rem;
            }
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .chat-title h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .chat-status {
            font-size: 0.85rem;
            opacity: 0.9;
            margin: 0;
        }

        /* Responsivo para chat title */
        @media (max-width: 768px) {
            .chat-title h3 {
                font-size: 1rem;
            }
            
            .chat-status {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .chat-title h3 {
                font-size: 0.9rem;
            }
            
            .chat-status {
                font-size: 0.7rem;
            }
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: #E5DDD5;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100%" height="100%" fill="%23E5DDD5"/><g opacity="0.03"><path d="M20 20h10v10h-10zM40 40h10v10h-10zM60 20h10v10h-10zM80 40h10v10h-10z" fill="%23000"/></g></svg>');
        }

        /* Responsivo para chat messages */
        @media (max-width: 768px) {
            .chat-messages {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .chat-messages {
                padding: 0.75rem;
            }
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            animation: fadeInUp 0.3s ease;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        /* Responsivo para message bubble */
        @media (max-width: 768px) {
            .message-bubble {
                max-width: 85%;
                padding: 0.6rem 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .message-bubble {
                max-width: 90%;
                padding: 0.5rem 0.7rem;
                font-size: 0.9rem;
            }
        }

        .message.user .message-bubble {
            background: #DCF8C6;
            border-bottom-right-radius: 4px;
        }

        .message.ai .message-bubble {
            background: white;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message-time {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.25rem;
            text-align: right;
        }

        .message.ai .message-time {
            text-align: left;
        }

        /* System hint styles */
        .system-hint {
            margin: 2rem auto;
            text-align: center;
            animation: fadeInUp 0.3s ease;
        }

        .system-hint-content {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            color: #614700;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-size: 14px;
            max-width: 80%;
            margin: 0 auto;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .system-hint-content strong {
            color: #8b6914;
        }

        @media (max-width: 768px) {
            .system-hint-content {
                max-width: 90%;
                padding: 0.8rem 1rem;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .system-hint-content {
                max-width: 95%;
                padding: 0.7rem 0.8rem;
                font-size: 12px;
            }
        }

        .chat-input-container {
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 0 0 16px 16px;
            border-top: 1px solid var(--border-color);
        }

        /* Responsivo para input container */
        @media (max-width: 768px) {
            .chat-input-container {
                padding: 0.75rem 1rem;
                border-radius: 0 0 12px 12px;
            }
        }

        @media (max-width: 480px) {
            .chat-input-container {
                padding: 0.5rem 0.75rem;
            }
        }

        .chat-input-form {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            resize: none;
            max-height: 100px;
            min-height: 44px;
        }

        .chat-input:focus {
            border-color: var(--whatsapp-green);
            outline: none;
        }

        .btn-send {
            background: var(--whatsapp-green);
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-send:hover {
            background: var(--whatsapp-dark);
            transform: scale(1.1);
        }

        .btn-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Chat States */
        .chat-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: var(--text-light);
        }

        .chat-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .chat-placeholder h4 {
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        /* User Prompt Styles */
        .user-prompt .simple-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .user-prompt h4 {
            color: var(--text-dark);
            margin-bottom: 0.8rem;
            font-weight: 500;
        }

        .prompt-suggestions {
            max-width: 400px;
            margin: 1rem 0;
        }

        .suggestion-bubbles {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .suggestion-bubble {
            background: var(--border-color);
            color: var(--text-dark);
            padding: 0.4rem 0.7rem;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
            user-select: none;
        }

        .suggestion-bubble:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--text-light);
            border-radius: 50%;
            animation: typingDots 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDots {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Optional Sections */
        .optional-section {
            margin-top: 1rem;
            padding: 1rem;
            background: #fafbfc;
            border-radius: 8px;
            border: 1px solid #e3e8ff;
            transition: all 0.3s ease;
        }

        .optional-section .form-label {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2D5A9B;
        }

        .optional-section .badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
        }

        .optional-section .form-text {
            color: #6c757d;
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
        }

        .services-container, .collaborators-container {
            background: white;
            border-radius: 6px;
            padding: 0.75rem;
            border: 1px solid #e9ecef;
        }

        .service-item, .collaborator-item {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .service-item:last-child, .collaborator-item:last-child {
            margin-bottom: 0;
        }

        .service-item .form-control, .collaborator-item .form-control,
        .service-item .form-select, .collaborator-item .form-select {
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
            height: auto;
        }

        .input-group-text {
            background: #e9ecef;
            border-color: #dee2e6;
            font-weight: 500;
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
        }

        /* Form control sizing overrides */
        .optional-section .form-control-sm,
        .optional-section .form-select-sm,
        .optional-section .input-group-sm .form-control,
        .optional-section .input-group-sm .input-group-text {
            font-size: 0.8rem;
            padding: 0.4rem 0.6rem;
            line-height: 1.2;
        }

        /* Small labels for optional sections */
        .form-label-sm {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #6c757d;
            display: block;
        }

        /* Better spacing for optional sections */
        .optional-section + .optional-section {
            margin-top: 0.75rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .optional-section {
                padding: 0.75rem;
            }
            
            .service-item, .collaborator-item {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .services-container, .collaborators-container {
                padding: 0.5rem;
            }
            
            .optional-section .form-text {
                font-size: 0.75rem;
            }
        }

        /* Responsive */
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .signup-section {
                position: static;
            }

            .chat-section {
                height: 600px;
            }

            .domain-selector {
                grid-template-columns: 1fr;
            }
        }

        /* Success State */
        .demo-created {
            text-align: center;
            padding: 2rem;
        }

        .demo-created .success-icon {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        .demo-credentials {
            background: var(--secondary-color);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: left;
        }

        .demo-credentials h5 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .credential-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .credential-item:last-child {
            border-bottom: none;
        }

        .credential-value {
            font-family: monospace;
            background: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* Popup Elegante para Email */
        .email-popup {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
            margin-top: 0.5rem;
            animation: popupSlideIn 0.3s ease-out;
        }
        
        .popup-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(45, 90, 155, 0.15);
            border: 1px solid rgba(45, 90, 155, 0.1);
            padding: 1.25rem;
            position: relative;
        }
        
        .popup-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            color: var(--text-dark);
            font-size: 0.95rem;
        }
        
        .popup-body p {
            font-size: 0.9rem;
            color: var(--text-dark);
            line-height: 1.4;
        }
        
        .popup-benefits {
            list-style: none;
            padding: 0;
            margin: 0.75rem 0;
        }
        
        .popup-benefits li {
            font-size: 0.85rem;
            color: var(--text-light);
            padding: 0.25rem 0;
            display: flex;
            align-items: center;
        }
        
        .popup-note {
            background: rgba(45, 90, 155, 0.05);
            border-radius: 6px;
            padding: 0.5rem;
            margin-top: 0.75rem;
            display: flex;
            align-items: center;
        }
        
        .popup-close {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .popup-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--text-dark);
        }
        
        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Responsivo para popup */
        @media (max-width: 768px) {
            .popup-content {
                padding: 1rem;
            }
            
            .popup-header {
                font-size: 0.9rem;
            }
            
            .popup-body p {
                font-size: 0.85rem;
            }
            
            .popup-benefits li {
                font-size: 0.8rem;
            }
        }

        /* Sistema de Notifica√ß√£o */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            font-weight: 500;
            animation: slideInRight 0.3s ease-out;
            cursor: pointer;
        }

        .notification.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .notification.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .notification.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .notification.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification.fade-out {
            animation: slideOutRight 0.3s ease-in;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <div class="logo-container">
                    <picture>
                        <source srcset="assets/images/optimized/UBS_Nac.webp" type="image/webp">
                        <img src="assets/images/UBS_Nac.png" alt="UBS - Sistema Universal de Agendamentos" class="logo-image">
                    </picture>
                    <h1 class="brand-text">UBS Demo Interativa</h1>
                </div>
                <a href="/" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-arrow-left me-2"></i>
                    Voltar
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Signup Section -->
        <div class="signup-section" id="signupSection">
            <h2>Crie seu Demo</h2>
            <p class="subtitle">Preencha os dados abaixo para criar um tenant de demonstra√ß√£o e testar nossa IA especializada em tempo real.</p>

            <form id="demoForm">
                <!-- 1. WhatsApp do Neg√≥cio - Primeiro campo -->
                <div class="form-group">
                    <label class="form-label" for="whatsappNumber">
                        <i class="fab fa-whatsapp me-2"></i>WhatsApp do Neg√≥cio
                    </label>
                    <input type="tel" class="form-control" id="whatsappNumber" 
                           placeholder="+55 (11) 99999-9999" maxlength="19" required>
                    <small class="form-text text-muted" id="verificationStatus">
                        <i class="fas fa-info-circle me-1"></i>Vamos verificar se este n√∫mero j√° tem um neg√≥cio cadastrado
                    </small>
                </div>

                <!-- 2. Seu WhatsApp de Usu√°rio - Segundo campo -->
                <div class="form-group">
                    <label class="form-label" for="userNumber">
                        <i class="fas fa-user me-2"></i>Seu WhatsApp de Usu√°rio
                    </label>
                    <input type="tel" class="form-control" id="userNumber" 
                           placeholder="+55 (11) 88888-8888" maxlength="19" required>
                    <small id="userStatus" class="form-text text-muted">
                        <i class="fas fa-info-circle me-1"></i>N√∫mero que voc√™ usar√° para conversar com a IA
                    </small>
                </div>

                <!-- Campos condicionais - aparecem baseado na exist√™ncia do neg√≥cio -->
                <div id="existingBusinessFields" style="display: none;">
                    <!-- Para neg√≥cios existentes - apenas mostrar dados -->
                    <div class="alert alert-success d-flex align-items-center">
                        <i class="fas fa-check-circle me-2"></i>
                        <div>
                            <strong>Neg√≥cio encontrado!</strong><br>
                            <small>Vamos reutilizar os dados existentes para o teste.</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nome do Neg√≥cio</label>
                        <input type="text" class="form-control" id="existingBusinessName" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email do Neg√≥cio</label>
                        <input type="email" class="form-control" id="existingBusinessEmail" readonly>
                    </div>
                </div>

                <div id="newBusinessFields" style="display: none;">
                    <!-- Para neg√≥cios novos - campos para preenchimento -->
                    <div class="alert alert-info d-flex align-items-center">
                        <i class="fas fa-plus-circle me-2"></i>
                        <div>
                            <strong>Novo neg√≥cio!</strong><br>
                            <small>Preencha os dados abaixo para criar seu demo.</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="businessName">
                            <i class="fas fa-store me-2"></i>Nome do Neg√≥cio
                        </label>
                        <input type="text" class="form-control" id="businessName" 
                               placeholder="Ex: Sal√£o Bella Vista" required>
                    </div>

                    <div class="form-group" style="position: relative;">
                        <label class="form-label" for="businessEmail">
                            <i class="fas fa-envelope me-2"></i>Email do Neg√≥cio
                        </label>
                        <input type="email" class="form-control" id="businessEmail" 
                               placeholder="contato@bellavista.com" required>
                        
                        <!-- Popup Elegante -->
                        <div class="email-popup" id="emailPopup" style="display: none;">
                            <div class="popup-content">
                                <div class="popup-header">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    <strong>üí° Dica Inteligente</strong>
                                </div>
                                <div class="popup-body">
                                    <p class="mb-2">Use seu <strong>email real</strong> para experimentar as notifica√ß√µes que seus clientes receber√£o:</p>
                                    <ul class="popup-benefits">
                                        <li><i class="fas fa-check-circle text-success me-1"></i> Confirma√ß√µes autom√°ticas</li>
                                        <li><i class="fas fa-check-circle text-success me-1"></i> Lembretes personalizados</li>
                                        <li><i class="fas fa-check-circle text-success me-1"></i> Newsletter do seu segmento</li>
                                    </ul>
                                    <div class="popup-note">
                                        <i class="fas fa-shield-alt text-primary me-1"></i>
                                        <small>Seus dados est√£o seguros. Use para teste real!</small>
                                    </div>
                                </div>
                                <button class="popup-close" id="closeEmailPopup">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-brain me-2"></i>Segmento do Neg√≥cio
                        </label>
                        <div class="domain-selector">
                            <div class="domain-option" data-domain="beauty">
                                <i class="fas fa-cut"></i>
                                Beleza
                            </div>
                            <div class="domain-option" data-domain="healthcare">
                                <i class="fas fa-heartbeat"></i>
                                Sa√∫de
                            </div>
                            <div class="domain-option" data-domain="legal">
                                <i class="fas fa-balance-scale"></i>
                                Jur√≠dico
                            </div>
                            <div class="domain-option" data-domain="education">
                                <i class="fas fa-graduation-cap"></i>
                                Educa√ß√£o
                            </div>
                            <div class="domain-option" data-domain="sports">
                                <i class="fas fa-dumbbell"></i>
                                Esportes
                            </div>
                            <div class="domain-option" data-domain="consulting">
                                <i class="fas fa-briefcase"></i>
                                Consultoria
                            </div>
                            <div class="domain-option" data-domain="general">
                                <i class="fas fa-star"></i>
                                Diversos
                            </div>
                        </div>
                        <input type="hidden" id="selectedDomain" required>
                    </div>
                </div>

                <!-- Se√ß√£o de Servi√ßos (Opcional) -->
                <div class="optional-section" id="servicesSection" style="display: none;">
                    <label class="form-label">
                        <i class="fas fa-list-alt me-2"></i>Servi√ßos do Neg√≥cio 
                        <span class="badge bg-secondary ms-2">Opcional</span>
                    </label>
                    <p class="form-text">
                        <i class="fas fa-lightbulb text-warning me-1"></i>
                        Cadastre servi√ßos para ver o sistema gerenciar pre√ßos automaticamente
                    </p>
                    
                    <div class="services-container">
                        <div class="service-item">
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <label class="form-label form-label-sm">Nome do Servi√ßo</label>
                                    <input type="text" class="form-control form-control-sm" id="service1Name" 
                                           placeholder="Nome do servi√ßo">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Pre√ßo</label>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">R$</span>
                                        <input type="text" class="form-control" id="service1Price" 
                                               placeholder="45,00" pattern="[0-9]+([,\.][0-9]{1,2})?" 
                                               title="Digite o valor em reais (ex: 45,00)">
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Dura√ß√£o</label>
                                    <select class="form-select form-select-sm" id="service1Duration">
                                        <option value="30">30min</option>
                                        <option value="45">45min</option>
                                        <option value="60" selected>1h</option>
                                        <option value="90">1h30</option>
                                        <option value="120">2h</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="service-item">
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <label class="form-label form-label-sm">Nome do Servi√ßo</label>
                                    <input type="text" class="form-control form-control-sm" id="service2Name" 
                                           placeholder="Nome do servi√ßo">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Pre√ßo</label>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">R$</span>
                                        <input type="text" class="form-control" id="service2Price" 
                                               placeholder="25,00" pattern="[0-9]+([,\.][0-9]{1,2})?" 
                                               title="Digite o valor em reais (ex: 25,00)">
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Dura√ß√£o</label>
                                    <select class="form-select form-select-sm" id="service2Duration">
                                        <option value="30">30min</option>
                                        <option value="45" selected>45min</option>
                                        <option value="60">1h</option>
                                        <option value="90">1h30</option>
                                        <option value="120">2h</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Colaboradores (Opcional) -->
                <div class="optional-section" id="collaboratorsSection" style="display: none;">
                    <label class="form-label">
                        <i class="fas fa-users me-2"></i>Equipe & Colaboradores 
                        <span class="badge bg-secondary ms-2">Opcional</span>
                    </label>
                    <p class="form-text">
                        <i class="fas fa-lightbulb text-warning me-1"></i>
                        Adicione colaboradores para ver o sistema organizar agendas individuais
                    </p>
                    
                    <div class="collaborators-container">
                        <div class="collaborator-item">
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <label class="form-label form-label-sm">Nome Completo</label>
                                    <input type="text" class="form-control form-control-sm" id="collaborator1Name" 
                                           placeholder="Nome completo">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Fun√ß√£o</label>
                                    <select class="form-select form-select-sm" id="collaborator1Role">
                                        <option value="professional">Profissional</option>
                                        <option value="specialist">Especialista</option>
                                        <option value="senior">S√™nior</option>
                                        <option value="manager">Coordenador</option>
                                    </select>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Hor√°rio</label>
                                    <select class="form-select form-select-sm" id="collaborator1Schedule">
                                        <option value="full">Integral</option>
                                        <option value="morning">Manh√£</option>
                                        <option value="afternoon">Tarde</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="collaborator-item">
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <label class="form-label form-label-sm">Nome Completo</label>
                                    <input type="text" class="form-control form-control-sm" id="collaborator2Name" 
                                           placeholder="Nome completo">
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Fun√ß√£o</label>
                                    <select class="form-select form-select-sm" id="collaborator2Role">
                                        <option value="professional" selected>Profissional</option>
                                        <option value="specialist">Especialista</option>
                                        <option value="senior">S√™nior</option>
                                        <option value="manager">Coordenador</option>
                                    </select>
                                </div>
                                <div class="col-6 col-md-3">
                                    <label class="form-label form-label-sm">Hor√°rio</label>
                                    <select class="form-select form-select-sm" id="collaborator2Schedule">
                                        <option value="full" selected>Integral</option>
                                        <option value="morning">Manh√£</option>
                                        <option value="afternoon">Tarde</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-create-demo" id="createDemoBtn" disabled>
                    <i class="fas fa-play-circle me-2" id="btnIcon"></i>
                    <span id="btnText">Come√ßar Teste</span>
                </button>
            </form>

        </div>

        <!-- Chat Section -->
        <div class="chat-section" id="chatSection">
            <div class="chat-header">
                <div class="chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chat-title">
                    <h3 id="chatBusinessName">IA Especializada UBS</h3>
                    <p class="chat-status" id="chatStatus">Preencha os dados ao lado para iniciar</p>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="chat-placeholder">
                    <i class="fas fa-comments"></i>
                    <h4>Pronto para conversar com nossa IA?</h4>
                    <p>Preencha os dados ao lado e clique em "Come√ßar Teste" para ativar nossa intelig√™ncia artificial especializada.</p>
                    <small class="mt-2">
                        A IA ir√° cumpriment√°-lo e voc√™ poder√° fazer agendamentos, tirar d√∫vidas e ver como ela entende seu neg√≥cio espec√≠fico.
                    </small>
                </div>
            </div>

            <div class="chat-input-container" style="display: none;" id="chatInputContainer">
                <form class="chat-input-form" id="chatForm">
                    <textarea class="chat-input" id="chatInput" 
                              placeholder="Digite sua mensagem..." rows="1"
                              disabled></textarea>
                    <button type="submit" class="btn-send" id="sendBtn" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        class DemoInterativa {
          constructor() {
            // estado
            this.demoData = null;
            this.chatActive = false;
            this.selectedDomain = null;
            this.businessExists = false;
            this.existingBusinessData = null;
            this.userConnected = false;
            this.userExists = false;
            this.whatsappNumber = null;
            this.userPhone = null;
            this.demoToken = null;
        
            // boot
            this.initializeEventListeners();
            this.initializeDomainSelector();
            this.initializeSmartForm();
          }
        
          /* ===================== UTIL ===================== */
          cleanPhoneNumber(v) { return String(v || '').replace(/\D/g, ''); }
          
          // ADICIONE: util para ler servi√ßo/profissional do formul√°rio
          getFormServices() {
            // S√≥ o primeiro √© obrigat√≥rio; pode expandir depois
            const name = (document.getElementById('service1Name')?.value || '').trim();
            const priceStr = (document.getElementById('service1Price')?.value || '').trim(); // "45,00"
            const duration = parseInt(document.getElementById('service1Duration')?.value || '60', 10);

            if (!name) return [];
            // normaliza para centavos
            const cents = Math.round(Number((priceStr || '0').replace(/\./g,'').replace(',','.')) * 100);
            return [{ name, price_cents: Number.isFinite(cents) ? cents : 0, duration_minutes: duration }];
          }

          getFormProfessionals() {
            const fullName = (document.getElementById('collaborator1Name')?.value || '').trim();
            const role = (document.getElementById('collaborator1Role')?.value || 'professional').trim();
            const schedule = (document.getElementById('collaborator1Schedule')?.value || 'full').trim();

            if (!fullName) return [];
            return [{
              full_name: fullName,
              role,
              schedule,
              // exig√™ncia: vincular automaticamente ao Google Calendar existente
              google_calendar_id: 'primary'
            }];
          }
          formatPhoneNumber(input) {
            let value = String(input.value || '').replace(/\D/g, '');
            if (value.length > 13) value = value.slice(0, 13);
            if (value.length >= 1) {
              if (value.length <= 2) value = `+${value}`;
              else if (value.length <= 4) value = `+${value.slice(0,2)} (${value.slice(2)}`;
              else if (value.length <= 9) value = `+${value.slice(0,2)} (${value.slice(2,4)}) ${value.slice(4)}`;
              else value = `+${value.slice(0,2)} (${value.slice(2,4)}) ${value.slice(4,9)}-${value.slice(9)}`;
            }
            input.value = value;
          }
          addMessage(text, who='ai') {
            const wrap = document.getElementById('chatMessages');
            const msg = document.createElement('div');
            msg.className = `message ${who}`;
            msg.innerHTML = `
              <div class="message-bubble">
                <div>${text}</div>
                <div class="message-time">${new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}</div>
              </div>`;
            wrap.appendChild(msg);
            wrap.scrollTop = wrap.scrollHeight;
          }
        
          /* ===================== EVENTOS GERAIS ===================== */
          initializeEventListeners() {
            // submit do formul√°rio principal
            const form = document.getElementById('demoForm');
            if (form) {
              form.addEventListener('submit', (e) => {
                e.preventDefault();
                this.createDemo();
              });
            }
        
            // bot√£o (backup)
            const createBtn = document.getElementById('createDemoBtn');
            if (createBtn) {
              createBtn.addEventListener('click', (e) => {
                if (createBtn.disabled) return;
                e.preventDefault();
                this.createDemo();
              });
            }
        
            // popup do e-mail
            const emailInput = document.getElementById('businessEmail');
            const emailPopup = document.getElementById('emailPopup');
            const closePopupBtn = document.getElementById('closeEmailPopup');
            if (emailInput && emailPopup && closePopupBtn) {
              emailInput.addEventListener('focus', () => {
                if (!localStorage.getItem('emailPopupShown')) {
                  emailPopup.style.display = 'block';
                  localStorage.setItem('emailPopupShown','true');
                }
              });
              closePopupBtn.addEventListener('click', () => { emailPopup.style.display = 'none'; });
              document.addEventListener('click', (e) => {
                if (emailPopup.style.display === 'block' &&
                    !emailInput.contains(e.target) && !emailPopup.contains(e.target)) {
                  emailPopup.style.display = 'none';
                }
              });
            }
        
            // chat
            const chatForm = document.getElementById('chatForm');
            if (chatForm) chatForm.addEventListener('submit', (e) => { e.preventDefault(); this.sendMessage(); });
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
              chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = Math.min(chatInput.scrollHeight, 100) + 'px';
              });
              chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); this.sendMessage(); }
              });
            }
        
            // m√°scaras dos telefones (s√≥ formata√ß√£o visual; a limpeza √© feita antes dos requests)
            const businessPhone = document.getElementById('whatsappNumber');
            if (businessPhone) businessPhone.addEventListener('input', (e) => this.formatPhoneNumber(e.target));
            const userPhone = document.getElementById('userNumber');
            if (userPhone) userPhone.addEventListener('input', (e) => this.formatPhoneNumber(e.target));
        
            // inputs de pre√ßo (v√≠rgula BR)
            ['service1Price','service2Price'].forEach(id => {
              const el = document.getElementById(id);
              if (!el) return;
              el.addEventListener('input', (e) => {
                let v = e.target.value.replace(/[^0-9,\.]/g,'').replace(/[,\.]+/g,',');
                const parts = v.split(',');
                if (parts.length > 2) v = parts[0] + ',' + parts.slice(1).join('');
                if (parts.length === 2 && parts[1].length > 2) v = parts[0] + ',' + parts[1].slice(0,2);
                e.target.value = v;
              });
              el.addEventListener('blur', (e) => {
                let v = e.target.value;
                if (v && !v.includes(',')) e.target.value = v + ',00';
                else if (v && v.endsWith(',')) e.target.value = v + '00';
                else if (v && v.includes(',')) {
                  const parts = v.split(',');
                  if (parts[1].length === 1) e.target.value = v + '0';
                }
              });
            });

            // üîÑ Listeners para valida√ß√£o em tempo real
            [
              'service1Name','service1Price','service1Duration',
              'collaborator1Name','collaborator1Role','collaborator1Schedule',
              'businessName','businessEmail'
            ].forEach(id => {
              const el = document.getElementById(id);
              if (el) {
                const ev = (el.tagName === 'SELECT') ? 'change' : 'input';
                el.addEventListener(ev, () => this.updateButtonState());
              }
            });
          }
        
          /* ===================== FORM INTELIGENTE ===================== */
          initializeSmartForm() {
            const whatsappInput = document.getElementById('whatsappNumber');
            const userInput = document.getElementById('userNumber');
            let businessTO, userTO;
        
            // verifica√ß√£o de neg√≥cio
            if (whatsappInput) {
              whatsappInput.addEventListener('input', (e) => {
                clearTimeout(businessTO);
                const n = this.cleanPhoneNumber(e.target.value);
                const statusEl = document.getElementById('verificationStatus');
                if (n.length >= 10) {
                  statusEl.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Verificando neg√≥cio...';
                  statusEl.className = 'form-text text-primary';
                  businessTO = setTimeout(() => this.checkExistingBusiness(e.target.value), 800);
                } else {
                  statusEl.innerHTML = '<i class="fas fa-info-circle me-1"></i>Vamos verificar se este n√∫mero j√° tem um neg√≥cio cadastrado';
                  statusEl.className = 'form-text text-muted';
                  this.hideAllConditionalFields();
                }
              });
            }
        
            // verifica√ß√£o do usu√°rio (apenas para habilitar bot√£o)
            if (userInput) {
              userInput.addEventListener('input', (e) => {
                clearTimeout(userTO);
                const n = this.cleanPhoneNumber(e.target.value);
                if (n.length >= 10) {
                  userTO = setTimeout(async () => {
                    if (this.existingBusinessData?.id) {
                      await this.checkUser(n, this.existingBusinessData.id);
                    } else {
                      this.userConnected = true;
                      this.updateButtonState();
                    }
                  }, 800);
                } else {
                  this.userConnected = false;
                  const el = document.getElementById('userStatus');
                  el.innerHTML = '<i class="fas fa-info-circle me-1"></i>N√∫mero que voc√™ usar√° para conversar com a IA';
                  el.className = 'form-text text-muted';
                  this.updateButtonState();
                }
              });
            }
        
            this.updateButtonState();
          }
        
          /* ===================== CHECKS BACKEND ===================== */
          async checkExistingBusiness(whatsappNumber) {
            try {
              const digits = this.cleanPhoneNumber(whatsappNumber);
              const resp = await fetch(`/api/demo/check-business?whatsapp=${encodeURIComponent(digits)}`);
              const result = await resp.json();
        
              const statusEl = document.getElementById('verificationStatus');
              if (result.success && result.exists) {
                this.businessExists = true;
                this.existingBusinessData = result.business;
                statusEl.innerHTML = `<i class="fas fa-check-circle me-1"></i>Neg√≥cio encontrado: ${result.business.business_name}`;
                statusEl.className = 'form-text text-success';
                this.showExistingBusinessFields();
              } else {
                this.businessExists = false;
                this.existingBusinessData = null;
                statusEl.innerHTML = '<i class="fas fa-plus-circle me-1"></i>N√∫mero novo - pronto para cadastrar';
                statusEl.className = 'form-text text-info';
                this.showNewBusinessFields();
              }
              this.updateButtonState();
            } catch (e) {
              const statusEl = document.getElementById('verificationStatus');
              statusEl.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>Erro na verifica√ß√£o - assumindo novo neg√≥cio';
              statusEl.className = 'form-text text-warning';
              this.businessExists = false;
              this.existingBusinessData = null;
              this.showNewBusinessFields();
              this.updateButtonState();
            }
          }
        
          async checkUser(userNumber, tenantId) {
            try {
              const clean = this.cleanPhoneNumber(userNumber);
              const resp = await fetch(`/api/demo/check-user?userPhone=${encodeURIComponent(clean)}&tenantId=${encodeURIComponent(tenantId)}`);
              const result = await resp.json();
              this.userExists = !!(result.success && result.exists);
              this.userConnected = true;
              this.updateButtonState();
              return this.userExists;
            } catch {
              this.userExists = false;
              this.userConnected = true;
              this.updateButtonState();
              return false;
            }
          }
        
          /* ===================== UI CONDICIONAL ===================== */
          hideAllConditionalFields() {
            ['existingBusinessFields','newBusinessFields','servicesSection','collaboratorsSection']
              .forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
            this.businessExists = false;
            this.existingBusinessData = null;
            this.updateButtonState();
          }
          showExistingBusinessFields() {
            const newFields = document.getElementById('newBusinessFields');
            const exFields = document.getElementById('existingBusinessFields');
            if (newFields) newFields.style.display = 'none';
            if (exFields) exFields.style.display = 'none'; // oculto por decis√£o de UX
            if (this.existingBusinessData?.domain) {
              this.selectedDomain = this.existingBusinessData.domain;
              const hid = document.getElementById('selectedDomain'); if (hid) hid.value = this.selectedDomain;
            }
            const svc = document.getElementById('servicesSection'); if (svc) svc.style.display = 'none';
            const col = document.getElementById('collaboratorsSection'); if (col) col.style.display = 'none';
          }
          showNewBusinessFields() {
            const ex = document.getElementById('existingBusinessFields'); if (ex) ex.style.display = 'none';
            const nw = document.getElementById('newBusinessFields'); if (nw) nw.style.display = 'block';
            this.selectedDomain = null;
            const hid = document.getElementById('selectedDomain'); if (hid) hid.value = '';

            // SEMPRE mostrar as se√ß√µes e trat√°-las como obrigat√≥rias para novo neg√≥cio
            const svc = document.getElementById('servicesSection'); if (svc) svc.style.display = 'block';
            const col = document.getElementById('collaboratorsSection'); if (col) col.style.display = 'block';
          }
          initializeDomainSelector() {
            const options = document.querySelectorAll('.domain-option');
            const hidden = document.getElementById('selectedDomain');
            options.forEach(opt => {
              opt.addEventListener('click', () => {
                options.forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
                this.selectedDomain = opt.dataset.domain;
                if (hidden) hidden.value = this.selectedDomain;
                this.showOptionalSections();
                // Aguardar DOM ser atualizado antes de validar campos
                setTimeout(() => this.updateButtonState(), 100);
              });
            });
          }
          showOptionalSections() {
            const s = document.getElementById('servicesSection');
            const c = document.getElementById('collaboratorsSection');
            if (s && c) {
              s.style.display = 'block';
              c.style.display = 'block';
              s.style.animation = 'fadeInUp 0.5s ease';
              c.style.animation = 'fadeInUp 0.7s ease';
            }
          }
          updateButtonState() {
            const btn = document.getElementById('createDemoBtn');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            const userValid = this.cleanPhoneNumber(document.getElementById('userNumber').value).length >= 10;
            const bizValid  = this.cleanPhoneNumber(document.getElementById('whatsappNumber').value).length >= 10;
            if (!btn || !btnText || !btnIcon) return;
        
            if (!userValid || !bizValid) {
              btn.disabled = true; btnText.textContent = 'Come√ßar Teste'; btnIcon.className = 'fas fa-play-circle me-2'; return;
            }
            if (!this.userConnected) {
              btn.disabled = true; btnText.textContent = 'Aguardando valida√ß√£o do usu√°rio...'; btnIcon.className = 'fas fa-spinner fa-spin me-2'; return;
            }
            // VALIDA√á√ÉO RIGOROSA: campos + setup completo
            const name = (document.getElementById('businessName')?.value || '').trim();
            const email = (document.getElementById('businessEmail')?.value || '').trim();
            const domainOk = !!this.selectedDomain;
            
            // Validar se campos b√°sicos est√£o preenchidos
            const allFieldsValid = name.length >= 3 && email.includes('@') && domainOk;
            
            const isNew = !this.businessExists;
            let hasService = true, hasPro = true;

            if (isNew) {
              const services = this.getFormServices();
              const pros = this.getFormProfessionals();
              hasService = services.length >= 1;
              hasPro = pros.length >= 1;
            }

            if (isNew && (!hasService || !hasPro)) {
              btn.disabled = true;
              btnText.textContent = !hasService
                ? 'Informe pelo menos 1 servi√ßo'
                : 'Informe pelo menos 1 profissional';
              btnIcon.className = 'fas fa-exclamation-triangle me-2';
              return;
            }
            
            if (!allFieldsValid) {
              btn.disabled = true;
              btnText.textContent = 'Preencha todos os campos obrigat√≥rios';
              btnIcon.className = 'fas fa-exclamation-triangle me-2';
              return;
            }
            
            // Campos v√°lidos - pode prosseguir
            btn.disabled = false;
            btnText.textContent = isNew ? 'Cadastrar e Come√ßar Teste' : 'Come√ßar Teste';
            btnIcon.className = isNew ? 'fas fa-rocket me-2' : 'fas fa-play-circle me-2';
          }
        
          /* ===================== CREATE & CHAT ===================== */
          async createDemo() {
            const btn = document.getElementById('createDemoBtn');
            const prev = btn.innerHTML;
            try {
              btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Criando Demo...';
        
              // dados de neg√≥cio
              const isExisting = this.businessExists && this.existingBusinessData;
              const businessName  = isExisting ? this.existingBusinessData.business_name : (document.getElementById('businessName')?.value || '');
              const businessEmail = isExisting ? this.existingBusinessData.email         : (document.getElementById('businessEmail')?.value || '');
              const domain = this.selectedDomain || 'general';
        
              const businessDigits = this.cleanPhoneNumber(document.getElementById('whatsappNumber').value);
              const userDigits     = this.cleanPhoneNumber(document.getElementById('userNumber').value);
        
              // NOVO: coletar do formul√°rio
              const services = isExisting ? [] : this.getFormServices();
              const professionals = isExisting ? [] : this.getFormProfessionals();
        
              const resp = await fetch('/api/demo/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  businessName, businessEmail, domain,
                  whatsappNumber: businessDigits,
                  userPhone: userDigits,
                  services,
                  professionals
                })
              });
              const result = await resp.json();
        
              if (!result.success) throw new Error(result.error || 'create failed');
              
              // Validar se setup est√° completo (servi√ßos e profissionais criados)
              if (!result.setup?.isComplete) {
                throw new Error('Setup incompleto: servi√ßos ou profissionais n√£o foram criados');
              }
        
              this.whatsappNumber = result.whatsappNumber || businessDigits;
              this.userPhone = userDigits;
              this.demoToken = result.demo_token;
              
              console.log('‚úÖ Setup completo:', result.setup);
        
              // üîí Oculta a √°rea de cadastro ap√≥s sucesso com transi√ß√£o suave
              const signupSection = document.getElementById('signupSection');
              if (signupSection) {
                signupSection.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                signupSection.style.opacity = '0';
                signupSection.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                  signupSection.style.display = 'none';
                }, 300);
                console.log('üìã Se√ß√£o de cadastro ocultada - foco 100% no chat');
              }
        
              // habilita chat
              this.chatActive = true;
              document.getElementById('chatInput').disabled = false;
              document.getElementById('sendBtn').disabled = false;
              document.getElementById('chatInputContainer').style.display = 'block';
              document.getElementById('chatStatus').textContent = 'Conversa iniciada!';
              
              // üéâ Banner de sucesso
              const chatContainer = document.getElementById('chatSection');
              if (chatContainer) {
                const successBanner = document.createElement('div');
                successBanner.innerHTML = `
                  <div class="alert alert-success border-0 shadow-sm mb-3" style="background: linear-gradient(135deg, #d1edff 0%, #e8f5e8 100%); animation: fadeInUp 0.5s ease-out;">
                    <div class="d-flex align-items-center">
                      <i class="fas fa-check-circle text-success me-2 fs-5"></i>
                      <div>
                        <strong>Demo criada com sucesso!</strong>
                        <small class="d-block text-muted">Sua ${result.setup?.services?.length || 1} servi√ßos e ${result.setup?.professionals?.length || 1} profissionais est√£o prontos.</small>
                      </div>
                    </div>
                  </div>
                `;
                chatContainer.prepend(successBanner.firstElementChild);
              }
              
              this.addMessage('üéâ Demo iniciada! Sua IA especializada est√° pronta. Envie uma mensagem para come√ßar.','ai');
            } catch (err) {
              console.error(err);
              this.addMessage('‚ö†Ô∏è Erro inesperado ao criar demo', 'ai');
            } finally {
              btn.disabled = false; btn.innerHTML = prev;
            }
          }
        
          async sendMessage() {
            const input = document.getElementById('chatInput');
            const text = (input.value || '').trim();
            if (!text) return;
            this.addMessage(text, 'user');
            input.value = '';
        
            if (!this.userPhone || !this.whatsappNumber || !this.demoToken) {
              this.addMessage('‚ö†Ô∏è A demo n√£o foi inicializada corretamente.', 'ai');
              return;
            }
        
            try {
              const resp = await fetch('/api/demo/chat', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${this.demoToken}`
                },
                body: JSON.stringify({
                  text,
                  userPhone: this.userPhone,
                  whatsappNumber: this.whatsappNumber
                })
              });
              const data = await resp.json();
              if (data.success && data.aiResponse) this.addMessage(data.aiResponse, 'ai');
              else this.addMessage('‚ö†Ô∏è Erro ao processar resposta da IA', 'ai');
            } catch (e) {
              this.addMessage('‚ö†Ô∏è Falha de conex√£o com o servidor demo', 'ai');
            }
          }
        }
        
        /* ===================== BOOT ===================== */
        window.addEventListener('DOMContentLoaded', () => {
          window.__demo = new DemoInterativa();
        });
        </script>
</body>
</html>
