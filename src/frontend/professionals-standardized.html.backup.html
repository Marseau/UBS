<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profissionais - UBS</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- UBS Standard Styles -->
    <link href="css/ubs-standard-styles.css" rel="stylesheet">
    <link href="css/dashboard-widgets.css" rel="stylesheet">
    <link href="css/super-admin-dashboard.css" rel="stylesheet">
    
    <style>
        /* LOGO GRANDE FORÇADO */
        .sidebar .logo {
            min-height: 180px !important;
            padding: 20px 10px !important;
        }
        
        .sidebar .logo img {
            width: 90% !important;
            max-width: 250px !important;
            max-height: 150px !important;
            height: auto !important;
        }
        
        /* Enhanced Calendar & Working Hours Styles */
        .schedule-mode-tabs {
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .schedule-mode-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 12px 20px;
            margin-right: 5px;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }
        
        .schedule-mode-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
            border-bottom: 3px solid #0056b3;
        }
        
        .schedule-mode-tabs .nav-link:hover:not(.active) {
            background-color: #f8f9fa;
            color: #007bff;
        }
        
        .working-hours-editor {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .working-hours-editor .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        .working-hours-editor .form-control-sm {
            font-size: 0.875rem;
        }
        
        .day-schedule-row {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s ease;
        }
        
        .day-schedule-row:hover {
            background-color: #f1f3f4;
            border-radius: 6px;
        }
        
        .day-schedule-row:last-child {
            border-bottom: none;
        }
        
        .interval-controls {
            margin-top: 10px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }
        
        .interval-item {
            display: flex;
            align-items-center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .break-interval {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .calendar-connection-status {
            transition: all 0.3s ease;
        }
        
        .privacy-notice {
            border-left: 4px solid #17a2b8;
        }
        
        .google-calendar-section {
            border-top: 2px solid #e9ecef;
            padding-top: 1rem;
        }
        
        .google-calendar-embed {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            min-height: 400px;
        }

        /* Enhanced Responsive Design Fixes */
        
        /* Modal Responsive Improvements */
        @media (max-width: 768px) {
            .modal-xl {
                max-width: 95% !important;
                margin: 10px auto !important;
            }
            
            .modal-dialog {
                margin: 5px !important;
            }
            
            .modal-content {
                border-radius: 10px;
                max-height: 95vh;
                overflow-y: auto;
            }
            
            .modal-body {
                padding: 15px !important;
                max-height: calc(95vh - 120px);
                overflow-y: auto;
            }
            
            .modal-header {
                padding: 12px 15px !important;
                border-bottom: 1px solid #dee2e6;
            }
            
            .modal-header h5 {
                font-size: 1.1rem !important;
            }
            
            .modal-footer {
                padding: 10px 15px !important;
                border-top: 1px solid #dee2e6;
            }
            
            .modal-footer .d-flex {
                margin: 0 !important;
            }
            
            .modal-footer .btn {
                min-height: 44px !important;
                font-weight: 500;
            }
        }
        
        /* Schedule Tabs Mobile Optimization */
        @media (max-width: 576px) {
            .schedule-mode-tabs {
                flex-direction: column !important;
                margin-bottom: 15px;
            }
            
            .schedule-mode-tabs .nav-item {
                width: 100% !important;
                margin-bottom: 5px !important;
            }
            
            .schedule-mode-tabs .nav-link {
                text-align: center !important;
                padding: 10px 15px !important;
                margin-right: 0 !important;
                border-radius: 6px !important;
                font-size: 0.9rem !important;
            }
        }
        
        /* Working Hours Mobile Layout */
        @media (max-width: 768px) {
            .day-schedule-row {
                flex-direction: column !important;
                align-items: stretch !important;
                padding: 15px 10px !important;
                gap: 10px;
            }
            
            .day-schedule-row .col-2,
            .day-schedule-row .col-3,
            .day-schedule-row .col-1 {
                width: 100% !important;
                max-width: 100% !important;
                flex: none !important;
            }
            
            .day-schedule-row .form-check {
                margin-bottom: 10px;
            }
            
            .day-schedule-row .form-check-label {
                font-size: 1.1rem !important;
                font-weight: 600 !important;
            }
            
            .time-inputs-row {
                display: flex !important;
                gap: 10px !important;
                align-items: center !important;
            }
            
            .time-inputs-row .form-control {
                flex: 1 !important;
            }
            
            .time-inputs-row small {
                flex-shrink: 0 !important;
                font-weight: 500 !important;
            }
            
            .interval-button-mobile {
                margin-top: 10px !important;
                width: 100% !important;
            }
        }
        
        /* Form Controls Mobile Optimization */
        @media (max-width: 576px) {
            .form-control,
            .form-select {
                font-size: 16px !important; /* Previne zoom no iOS */
                min-height: 44px !important; /* Touch target mínimo */
            }
            
            .btn {
                min-height: 44px !important;
                font-size: 1rem !important;
            }
            
            .btn-sm {
                min-height: 38px !important;
                font-size: 0.9rem !important;
                padding: 8px 12px !important;
            }
        }
        
        /* Google Calendar Embed Responsive */
        @media (max-width: 768px) {
            .google-calendar-embed {
                min-height: 300px !important;
            }
            
            .google-calendar-embed iframe {
                height: 300px !important;
            }
        }
        
        /* Advanced Schedule Mobile */
        @media (max-width: 576px) {
            .advanced-schedule-controls {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .advanced-schedule-controls .btn {
                width: 100% !important;
            }
        }
        
        /* Tab Content Mobile Spacing */
        @media (max-width: 768px) {
            .tab-content {
                padding: 15px 5px !important;
            }
            
            .mode-description {
                margin-bottom: 20px !important;
                padding: 15px !important;
                background-color: #f8f9fa !important;
                border-radius: 8px !important;
            }
            
            .mode-description h6 {
                font-size: 1rem !important;
                margin-bottom: 8px !important;
            }
            
            .mode-description p {
                font-size: 0.9rem !important;
                line-height: 1.4 !important;
            }
        }
        
        /* Professional List Table Mobile */
        @media (max-width: 768px) {
            .table-responsive {
                border: none !important;
            }
            
            .table th,
            .table td {
                padding: 8px 4px !important;
                font-size: 0.85rem !important;
                vertical-align: middle !important;
            }
            
            .btn-sm {
                padding: 4px 8px !important;
                font-size: 0.75rem !important;
            }
            
            .badge {
                font-size: 0.7rem !important;
                padding: 4px 6px !important;
            }
        }
        
        .mode-description {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 6px 6px 0;
        }
        
        .mode-description h6 {
            color: #1976d2;
            margin-bottom: 8px;
        }
        
        .schedule-preview {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .advanced-schedule-options {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .week-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .week-selector .btn {
            flex: 1;
            min-width: 100px;
        }
        
        /* Calendar status badges */
        .badge.bg-success {
            background-color: #28a745 !important;
        }
        
        .badge.bg-danger {
            background-color: #dc3545 !important;
        }
        
        .badge.bg-secondary {
            background-color: #6c757d !important;
        }
        
        .badge.bg-warning {
            background-color: #ffc107 !important;
            color: #000 !important;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .schedule-mode-tabs .nav-link {
                padding: 8px 12px;
                font-size: 0.875rem;
            }
            
            .interval-item {
                flex-direction: column;
                align-items: stretch;
            }
            
            .week-selector {
                flex-direction: column;
            }
        }
        
        /* Animation for tab transitions */
        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <nav class="sidebar">
        <div class="logo">
            <img src="assets/images/optimized/Logo_Int_Branco.webp" alt="UBS Logo">
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Dashboard</div>
            <a class="nav-link" href="dashboard-tenant-admin.html">
                <i class="fas fa-chart-line"></i>
                <span>Visão Geral</span>
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Operações</div>
            <a class="nav-link" href="appointments-standardized.html">
                <i class="fas fa-calendar-check"></i>
                <span>Agendamentos</span>
            </a>
            <a class="nav-link" href="customers-standardized.html">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </a>
            <a class="nav-link" href="services-standardized.html">
                <i class="fas fa-concierge-bell"></i>
                <span>Serviços</span>
            </a>
            <a class="nav-link active" href="professionals-standardized.html">
                <i class="fas fa-user-tie"></i>
                <span>Profissionais</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Comunicação</div>
            <a class="nav-link" href="conversations-standardized.html">
                <i class="fab fa-whatsapp"></i>
                <span>Conversas</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Financeiro</div>
            <a class="nav-link" href="payments-standardized.html">
                <i class="fas fa-credit-card"></i>
                <span>Pagamentos</span>
            </a>
            <a class="nav-link" href="billing-standardized.html">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Faturamento</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Sistema</div>
            <a class="nav-link" href="settings-standardized.html">
                <i class="fas fa-cog"></i>
                <span>Configurações</span>
            </a>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- Header -->
        <div class="top-navbar">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-0">Gerenciamento de Profissionais</h4>
                    <small class="text-muted">Gerencie sua equipe de profissionais e horários</small>
                </div>
                <div class="user-menu d-flex flex-column align-items-end gap-1">
                    <!-- User Menu -->
                    <div class="dropdown">
                        <button class="btn btn-link dropdown-toggle d-flex align-items-center compact-button" data-bs-toggle="dropdown">
                            <div class="user-avatar me-2" id="userAvatar">B</div>
                            <div class="d-none d-md-block text-start">
                                <div class="fw-medium compact-text" id="userName">Salão Bella Vista</div>
                                <small class="text-muted compact-small" id="userRole">Administrador</small>
                            </div>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end compact-dropdown">
                            <li><a class="dropdown-item compact-dropdown-item" href="settings-standardized.html"><i class="fas fa-user-cog me-2"></i>Perfil</a></li>
                            <li><a class="dropdown-item compact-dropdown-item" href="#" onclick="exportData()"><i class="fas fa-download me-2"></i>Exportar Dados</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item compact-dropdown-item" href="#" onclick="refreshData()"><i class="fas fa-sync me-2"></i>Atualizar</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item compact-dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="container-fluid p-4">
            <!-- Quick Actions -->
            <div class="d-flex gap-2 mb-3">
                <button class="btn btn-success" onclick="addProfessional()">
                    <i class="fas fa-plus me-2"></i>Novo Profissional
                </button>
                <button class="btn btn-outline-primary" onclick="bulkScheduleUpdate()">
                    <i class="fas fa-calendar-alt me-2"></i>Atualizar Horários em Lote
                </button>
                <button class="btn btn-outline-info" onclick="exportSchedules()">
                    <i class="fas fa-download me-2"></i>Exportar Horários
                </button>
            </div>
            
            <!-- KPIs -->            
            <div class="row g-3 mb-4">
                <div class="col-xl-3 col-md-6">
                    <div class="metric-card">
                        <div class="metric-value">8</div>
                        <div class="metric-title">Total Profissionais</div>
                        <div class="metric-subtitle">Ativos</div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6">
                    <div class="metric-card">
                        <div class="metric-value">6</div>
                        <div class="metric-title">Trabalhando Hoje</div>
                        <div class="metric-subtitle">Em atividade</div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6">
                    <div class="metric-card">
                        <div class="metric-value">5</div>
                        <div class="metric-title">Google Calendar</div>
                        <div class="metric-subtitle">Conectados</div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6">
                    <div class="metric-card">
                        <div class="metric-value">4.8</div>
                        <div class="metric-title">Avaliação Média</div>
                        <div class="metric-subtitle">Satisfação</div>
                    </div>
                </div>
            </div>
            
            <!-- Tabela de Profissionais -->
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-primary">
                        <tr>
                            <th>Profissional</th>
                            <th>Email</th>
                            <th>Telefone</th>
                            <th>Serviços</th>
                            <th>Calendar</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Ana Costa</strong></td>
                            <td>ana.costa@email.com</td>
                            <td>(11) 99999-1111</td>
                            <td><span class="badge bg-primary me-1">Corte Feminino</span><span class="badge bg-success">Coloração</span></td>
                            <td><span class="badge bg-success"><i class="fab fa-google me-1"></i>Conectado</span></td>
                            <td><span class="badge bg-success">Ativo</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewProfessional(1, 'Ana Costa', 'ana.costa@email.com', '(11) 99999-1111', 'Cabelo,Coloração', 'Ativo', 'Especialista em cortes femininos e coloração')" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editProfessional(1, 'Ana Costa', 'ana.costa@email.com', '(11) 99999-1111', 'Cabelo,Coloração', 'Ativo', 'Especialista em cortes femininos e coloração')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="viewCalendar(1, 'Ana Costa')" title="Ver Calendário">
                                    <i class="fas fa-calendar"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Bruno Lima</strong></td>
                            <td>bruno.lima@email.com</td>
                            <td>(11) 98888-2222</td>
                            <td><span class="badge bg-primary me-1">Corte Masculino</span><span class="badge bg-info">Barba</span></td>
                            <td><span class="badge bg-warning"><i class="fab fa-google me-1"></i>Configurando</span></td>
                            <td><span class="badge bg-success">Ativo</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewProfessional(2, 'Bruno Lima', 'bruno.lima@email.com', '(11) 98888-2222', 'Barba,Bigode', 'Ativo', 'Especialista em barbas e cortes masculinos')" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editProfessional(2, 'Bruno Lima', 'bruno.lima@email.com', '(11) 98888-2222', 'Barba,Bigode', 'Ativo', 'Especialista em barbas e cortes masculinos')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="viewCalendar(2, 'Bruno Lima')" title="Ver Calendário">
                                    <i class="fas fa-calendar"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Carla Santos</strong></td>
                            <td>carla.santos@email.com</td>
                            <td>(11) 97777-3333</td>
                            <td><span class="badge bg-warning me-1">Manicure</span><span class="badge bg-secondary">Pedicure</span></td>
                            <td><span class="badge bg-secondary"><i class="fas fa-calendar-times me-1"></i>Não configurado</span></td>
                            <td><span class="badge bg-success">Ativo</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewProfessional(3, 'Carla Santos', 'carla.santos@email.com', '(11) 97777-3333', 'Manicure,Pedicure', 'Ativo', 'Especialista em cuidados das unhas')" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editProfessional(3, 'Carla Santos', 'carla.santos@email.com', '(11) 97777-3333', 'Manicure,Pedicure', 'Ativo', 'Especialista em cuidados das unhas')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="viewCalendar(3, 'Carla Santos')" title="Ver Calendário">
                                    <i class="fas fa-calendar"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Diego Oliveira</strong></td>
                            <td>diego.oliveira@email.com</td>
                            <td>(11) 96666-4444</td>
                            <td><span class="badge bg-success me-1">Limpeza de Pele</span><span class="badge bg-danger">Massagem</span></td>
                            <td><span class="badge bg-danger"><i class="fas fa-exclamation-triangle me-1"></i>Erro</span></td>
                            <td><span class="badge bg-warning">Férias</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewProfessional(4, 'Diego Oliveira', 'diego.oliveira@email.com', '(11) 96666-4444', 'Tratamentos,Massagem', 'Férias', 'Especialista em tratamentos faciais e massagens')" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editProfessional(4, 'Diego Oliveira', 'diego.oliveira@email.com', '(11) 96666-4444', 'Tratamentos,Massagem', 'Férias', 'Especialista em tratamentos faciais e massagens')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="viewCalendar(4, 'Diego Oliveira')" title="Ver Calendário">
                                    <i class="fas fa-calendar"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Modal de Visualização -->
    <div class="modal fade" id="viewProfessionalModal" tabindex="-1" aria-labelledby="viewProfessionalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewProfessionalModalLabel">
                        <i class="fas fa-user-tie me-2"></i>Detalhes do Profissional
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label"><strong>Nome:</strong></label>
                            <p id="viewProfessionalName" class="form-control-plaintext">-</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label"><strong>Email:</strong></label>
                            <p id="viewProfessionalEmail" class="form-control-plaintext">-</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label"><strong>Telefone:</strong></label>
                            <p id="viewProfessionalPhone" class="form-control-plaintext">-</p>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label"><strong>Status:</strong></label>
                            <p id="viewProfessionalStatus" class="form-control-plaintext">-</p>
                        </div>
                        <div class="col-12">
                            <label class="form-label"><strong>Serviços:</strong></label>
                            <p id="viewProfessionalSpecialties" class="form-control-plaintext">-</p>
                        </div>
                        <div class="col-12">
                            <label class="form-label"><strong>Bio:</strong></label>
                            <p id="viewProfessionalBio" class="form-control-plaintext">-</p>
                        </div>
                        
                        <!-- Google Calendar Status Section -->
                        <div class="col-12">
                            <hr class="my-3">
                            <h6 class="mb-3"><i class="fab fa-google me-2"></i>Google Calendar</h6>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label"><strong>Status da Conexão:</strong></label>
                            <p id="viewCalendarStatus" class="form-control-plaintext">
                                <span class="badge bg-secondary">Não configurado</span>
                            </p>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label"><strong>Calendário:</strong></label>
                            <p id="viewCalendarId" class="form-control-plaintext">-</p>
                        </div>
                        
                        <!-- Working Hours Display -->
                        <div class="col-12" id="viewWorkingHours">
                            <label class="form-label"><strong>Horários de Trabalho:</strong></label>
                            <div class="border rounded p-3 bg-light">
                                <div id="viewWorkingHoursContent">Não configurado</div>
                            </div>
                        </div>
                        
                        <!-- Advanced Schedule Info -->
                        <div class="col-12" id="viewAdvancedSchedule" style="display: none;">
                            <label class="form-label"><strong>Agenda Avançada:</strong></label>
                            <div class="border rounded p-3 bg-light">
                                <div id="viewAdvancedScheduleContent">Não configurado</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="d-flex flex-column flex-md-row w-100 gap-2">
                        <button type="button" class="btn btn-secondary flex-fill flex-md-grow-0 order-2 order-md-0" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Fechar
                        </button>
                        <button type="button" class="btn btn-info flex-fill flex-md-grow-0 order-1 order-md-1" onclick="viewProfessionalCalendar()">
                            <i class="fas fa-calendar me-2"></i><span class="d-none d-md-inline">Ver Calendário</span><span class="d-md-none">Calendário</span>
                        </button>
                        <button type="button" class="btn btn-primary flex-fill flex-md-grow-0 order-0 order-md-2" onclick="editProfessionalFromView()">
                            <i class="fas fa-edit me-2"></i>Editar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edição/Novo Profissional -->
    <div class="modal fade" id="editProfessionalModal" tabindex="-1" aria-labelledby="editProfessionalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfessionalModalLabel">
                        <i class="fas fa-edit me-2"></i>Editar Profissional
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProfessionalForm">
                        <input type="hidden" id="editProfessionalId" name="professionalId">
                        
                        <!-- Basic Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-user me-2"></i>Informações Básicas
                                </h6>
                            </div>
                            <div class="col-md-6">
                                <label for="editProfessionalName" class="form-label">Nome Completo</label>
                                <input type="text" class="form-control" id="editProfessionalName" name="name" required>
                            </div>
                            <div class="col-md-6">
                                <label for="editProfessionalEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="editProfessionalEmail" name="email">
                            </div>
                            <div class="col-md-6">
                                <label for="editProfessionalPhone" class="form-label">Telefone</label>
                                <input type="tel" class="form-control" id="editProfessionalPhone" name="phone">
                            </div>
                            <div class="col-md-6">
                                <label for="editProfessionalStatus" class="form-label">Status</label>
                                <select class="form-select" id="editProfessionalStatus" name="status" required>
                                    <option value="">Selecione o status</option>
                                    <option value="active">Ativo</option>
                                    <option value="inactive">Inativo</option>
                                    <option value="vacation">Férias</option>
                                    <option value="sick">Licença Médica</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label for="editProfessionalServices" class="form-label">Serviços</label>
                                <select class="form-select" id="editProfessionalServices" name="services" multiple size="5">
                                    <option value="">Carregando serviços...</option>
                                </select>
                                <div class="form-text">Selecione os serviços que este profissional oferece (Ctrl+clique para múltipla seleção)</div>
                            </div>
                            <div class="col-12">
                                <label for="editProfessionalBio" class="form-label">Bio/Descrição</label>
                                <textarea class="form-control" id="editProfessionalBio" name="bio" rows="3" placeholder="Breve descrição do profissional, experiência, especialidades..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Schedule & Calendar Configuration -->
                        <div class="row g-3">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-calendar-alt me-2"></i>Configuração de Agenda e Horários
                                </h6>
                                
                                <!-- Schedule Mode Tabs -->
                                <ul class="nav nav-tabs schedule-mode-tabs" id="scheduleModeTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="basic-schedule-tab" data-bs-toggle="tab" data-bs-target="#basic-schedule" type="button" role="tab" aria-controls="basic-schedule" aria-selected="true">
                                            <i class="fas fa-clock me-2"></i>Horários Básicos
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="advanced-schedule-tab" data-bs-toggle="tab" data-bs-target="#advanced-schedule" type="button" role="tab" aria-controls="advanced-schedule" aria-selected="false">
                                            <i class="fas fa-calendar-week me-2"></i>Agenda Avançada
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="google-calendar-tab" data-bs-toggle="tab" data-bs-target="#google-calendar" type="button" role="tab" aria-controls="google-calendar" aria-selected="false">
                                            <i class="fab fa-google me-2"></i>Google Calendar
                                        </button>
                                    </li>
                                </ul>
                                
                                <!-- Tab Content -->
                                <div class="tab-content mt-3" id="scheduleModeTabsContent">
                                    <!-- Basic Schedule Tab -->
                                    <div class="tab-pane fade show active" id="basic-schedule" role="tabpanel" aria-labelledby="basic-schedule-tab">
                                        <div class="mode-description">
                                            <h6><i class="fas fa-info-circle me-2"></i>Modo Básico</h6>
                                            <p class="mb-0">Configure horários padrão que se repetem toda semana. Ideal para profissionais com rotina fixa. Os horários configurados aqui serão usados para mostrar disponibilidade aos clientes.</p>
                                        </div>
                                        
                                        <div class="working-hours-editor">
                                            <!-- Monday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingMon" checked onchange="toggleDaySchedule('Mon')">
                                                        <label class="form-check-label fw-medium" for="workingMon">Segunda</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingMonStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingMonEnd" value="18:00">
                                                        <button type="button" class="btn btn-sm btn-outline-secondary interval-button-mobile" onclick="addInterval('Mon')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingMonIntervals" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Tuesday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingTue" checked onchange="toggleDaySchedule('Tue')">
                                                        <label class="form-check-label fw-medium" for="workingTue">Terça</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingTueStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingTueEnd" value="18:00">
                                                        <button type="button" class="btn btn-sm btn-outline-secondary interval-button-mobile" onclick="addInterval('Tue')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingTueIntervals" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Wednesday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingWed" checked onchange="toggleDaySchedule('Wed')">
                                                        <label class="form-check-label fw-medium" for="workingWed">Quarta</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingWedStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingWedEnd" value="18:00">
                                                        <button type="button" class="btn btn-sm btn-outline-secondary interval-button-mobile" onclick="addInterval('Wed')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingWedIntervals" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Thursday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingThu" checked onchange="toggleDaySchedule('Thu')">
                                                        <label class="form-check-label fw-medium" for="workingThu">Quinta</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingThuStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingThuEnd" value="18:00">
                                                        <button type="button" class="btn btn-sm btn-outline-secondary interval-button-mobile" onclick="addInterval('Thu')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingThuIntervals" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Friday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingFri" checked onchange="toggleDaySchedule('Fri')">
                                                        <label class="form-check-label fw-medium" for="workingFri">Sexta</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingFriStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingFriEnd" value="18:00">
                                                        <button type="button" class="btn btn-sm btn-outline-secondary interval-button-mobile" onclick="addInterval('Fri')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingFriIntervals" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Saturday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingSat" onchange="toggleDaySchedule('Sat')">
                                                        <label class="form-check-label fw-medium" for="workingSat">Sábado</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingSatStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingSatEnd" value="14:00">
                                                </div>
                                                <div class="col-3">
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addInterval('Sat')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingSatIntervals" style="display: none;"></div>
                                            </div>
                                            
                                            <!-- Sunday -->
                                            <div class="day-schedule-row row align-items-center">
                                                <div class="col-12 col-md-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="workingSun" onchange="toggleDaySchedule('Sun')">
                                                        <label class="form-check-label fw-medium" for="workingSun">Domingo</label>
                                                    </div>
                                                </div>
                                                <div class="col-12 col-md-10">
                                                    <div class="time-inputs-row d-flex align-items-center gap-2">
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingSunStart" value="09:00">
                                                        <small class="text-muted">até</small>
                                                        <input type="time" class="form-control form-control-sm flex-grow-1" id="workingSunEnd" value="14:00">
                                                </div>
                                                <div class="col-3">
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addInterval('Sun')">
                                                            <i class="fas fa-plus me-1"></i><span class="d-none d-md-inline">Intervalos</span><span class="d-md-none">+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-12" id="workingSunIntervals" style="display: none;"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Quick Actions -->
                                        <div class="mt-3">
                                            <button type="button" class="btn btn-sm btn-outline-primary me-2" onclick="copyScheduleToAll()">
                                                <i class="fas fa-copy me-1"></i>Copiar para Todos os Dias
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary me-2" onclick="setBusinessHours()">
                                                <i class="fas fa-briefcase me-1"></i>Horário Comercial (9h-18h)
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-info" onclick="previewSchedule()">
                                                <i class="fas fa-eye me-1"></i>Visualizar Agenda
                                            </button>
                                        </div>
                                        
                                        <!-- Schedule Preview -->
                                        <div class="schedule-preview mt-3" id="schedulePreview" style="display: none;">
                                            <h6><i class="fas fa-eye me-2"></i>Prévia da Agenda</h6>
                                            <div id="schedulePreviewContent"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Advanced Schedule Tab -->
                                    <div class="tab-pane fade" id="advanced-schedule" role="tabpanel" aria-labelledby="advanced-schedule-tab">
                                        <div class="mode-description">
                                            <h6><i class="fas fa-info-circle me-2"></i>Agenda Avançada</h6>
                                            <p class="mb-0">Configure horários diferentes por semana/mês, períodos específicos, exceções e horários especiais. Ideal para profissionais com agenda variável ou sazonalidade.</p>
                                        </div>
                                        
                                        <div class="advanced-schedule-options">
                                            <div class="row g-3">
                                                <div class="col-12">
                                                    <h6><i class="fas fa-calendar-week me-2"></i>Configuração por Período</h6>
                                                </div>
                                                
                                                <!-- Period Selector -->
                                                <div class="col-md-6">
                                                    <label class="form-label">Tipo de Período</label>
                                                    <select class="form-select" id="advancedPeriodType">
                                                        <option value="weekly">Semanal (padrão)</option>
                                                        <option value="monthly">Mensal</option>
                                                        <option value="custom">Período Personalizado</option>
                                                        <option value="seasonal">Sazonal</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="col-md-6">
                                                    <label class="form-label">Aplicar a</label>
                                                    <select class="form-select" id="advancedApplyTo">
                                                        <option value="all">Todos os períodos</option>
                                                        <option value="current">Período atual</option>
                                                        <option value="future">Períodos futuros</option>
                                                        <option value="range">Intervalo específico</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- Date Range (shown when range is selected) -->
                                                <div class="col-md-6" id="advancedDateRange" style="display: none;">
                                                    <label class="form-label">Data Início</label>
                                                    <input type="date" class="form-control" id="advancedStartDate">
                                                </div>
                                                
                                                <div class="col-md-6" id="advancedDateRangeEnd" style="display: none;">
                                                    <label class="form-label">Data Fim</label>
                                                    <input type="date" class="form-control" id="advancedEndDate">
                                                </div>
                                                
                                                <!-- Week Selector -->
                                                <div class="col-12" id="advancedWeekSelector">
                                                    <label class="form-label">Semanas do Mês</label>
                                                    <div class="week-selector">
                                                        <button type="button" class="btn btn-outline-primary" data-week="1">1ª Semana</button>
                                                        <button type="button" class="btn btn-outline-primary" data-week="2">2ª Semana</button>
                                                        <button type="button" class="btn btn-outline-primary" data-week="3">3ª Semana</button>
                                                        <button type="button" class="btn btn-outline-primary" data-week="4">4ª Semana</button>
                                                        <button type="button" class="btn btn-outline-primary" data-week="5">5ª Semana</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- Multiple Periods per Day -->
                                                <div class="col-12">
                                                    <h6><i class="fas fa-clock me-2"></i>Períodos de Trabalho</h6>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="enableMultiplePeriods">
                                                        <label class="form-check-label" for="enableMultiplePeriods">
                                                            Permitir múltiplos períodos por dia (ex: manhã e tarde separados)
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <!-- Exceptions -->
                                                <div class="col-12">
                                                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Exceções e Feriados</h6>
                                                    <div class="mb-3">
                                                        <button type="button" class="btn btn-outline-danger me-2" onclick="addException()">
                                                            <i class="fas fa-plus me-1"></i>Adicionar Exceção
                                                        </button>
                                                        <button type="button" class="btn btn-outline-info" onclick="importHolidays()">
                                                            <i class="fas fa-download me-1"></i>Importar Feriados Nacionais
                                                        </button>
                                                    </div>
                                                    <div id="exceptionsList" class="border rounded p-3 bg-light">
                                                        <small class="text-muted">Nenhuma exceção configurada</small>
                                                    </div>
                                                </div>
                                                
                                                <!-- Save Advanced Schedule -->
                                                <div class="col-12">
                                                    <div class="alert alert-info">
                                                        <i class="fas fa-info-circle me-2"></i>
                                                        <strong>Dica:</strong> Configurações avançadas sobrescrevem os horários básicos. Use este modo apenas se precisar de flexibilidade total na agenda.
                                                    </div>
                                                    <button type="button" class="btn btn-primary" onclick="saveAdvancedSchedule()">
                                                        <i class="fas fa-save me-2"></i>Salvar Configuração Avançada
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Google Calendar Tab -->
                                    <div class="tab-pane fade" id="google-calendar" role="tabpanel" aria-labelledby="google-calendar-tab">
                                        <div class="mode-description">
                                            <h6><i class="fas fa-info-circle me-2"></i>Integração com Google Calendar</h6>
                                            <p class="mb-0">Sincronize diretamente com o Google Calendar para gerenciamento avançado. Os agendamentos serão criados automaticamente no Google Calendar e conflitos serão detectados em tempo real.</p>
                                        </div>
                                        
                                        <!-- Calendar Connection Status -->
                                        <div class="card bg-light border-0 mb-3">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <strong id="calendarConnectionLabel">Status da Conexão:</strong>
                                                        <span id="calendarConnectionStatus" class="badge bg-secondary ms-2">Não configurado</span>
                                                    </div>
                                                    <div>
                                                        <button type="button" class="btn btn-sm btn-primary" id="connectCalendarBtn" onclick="connectGoogleCalendar()">
                                                            <i class="fab fa-google me-1"></i>Conectar Google Calendar
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-danger" id="disconnectCalendarBtn" onclick="disconnectGoogleCalendar()" style="display: none;">
                                                            <i class="fas fa-unlink me-1"></i>Desconectar
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-success" id="testCalendarBtn" onclick="testGoogleCalendar()" style="display: none;">
                                                            <i class="fas fa-check-circle me-1"></i>Testar Conexão
                                                        </button>
                                                    </div>
                                                </div>
                                                <small class="text-muted d-block mt-2" id="calendarConnectionInfo">
                                                    Para sincronizar agendamentos automaticamente com o Google Calendar, conecte sua conta.
                                                </small>
                                            </div>
                                        </div>
                                        
                                        <!-- Google Calendar Options (shown when connected) -->
                                        <div id="googleCalendarOptions" style="display: none;">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Calendário para Sincronização</label>
                                                    <select class="form-select" id="googleCalendarSelect">
                                                        <option value="primary">Calendário Principal</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="col-md-6">
                                                    <label class="form-label">Modo de Sincronização</label>
                                                    <select class="form-select" id="syncMode">
                                                        <option value="bidirectional">Bidirecional (recomendado)</option>
                                                        <option value="to_google">Apenas para Google Calendar</option>
                                                        <option value="from_google">Apenas do Google Calendar</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="col-12">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="detectConflicts" checked>
                                                        <label class="form-check-label" for="detectConflicts">
                                                            Detectar conflitos automaticamente
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-12">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="autoBlockBusyTime" checked>
                                                        <label class="form-check-label" for="autoBlockBusyTime">
                                                            Bloquear horários ocupados no Google Calendar
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <!-- Calendar Embed -->
                                                <div class="col-12">
                                                    <h6><i class="fas fa-calendar me-2"></i>Visualização do Calendário</h6>
                                                    <div class="google-calendar-embed">
                                                        <iframe id="googleCalendarFrame" 
                                                                src="" 
                                                                style="border: 0; width: 100%; height: 400px;" 
                                                                frameborder="0" 
                                                                scrolling="no">
                                                        </iframe>
                                                    </div>
                                                    <div class="mt-2">
                                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="refreshCalendarEmbed()">
                                                            <i class="fas fa-sync me-1"></i>Atualizar Calendário
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-outline-info" onclick="openGoogleCalendar()" target="_blank">
                                                            <i class="fas fa-external-link-alt me-1"></i>Abrir no Google Calendar
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <!-- Google Forms Integration -->
                                                <div class="col-12">
                                                    <h6><i class="fab fa-google me-2"></i>Integração com Google Forms</h6>
                                                    <div class="alert alert-info">
                                                        <i class="fas fa-lightbulb me-2"></i>
                                                        <strong>Experimental:</strong> Crie formulários de agendamento diretamente no Google Forms
                                                    </div>
                                                    <button type="button" class="btn btn-outline-primary me-2" onclick="createGoogleForm()">
                                                        <i class="fab fa-google me-1"></i>Criar Formulário de Agendamento
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary" onclick="embedGoogleForm()">
                                                        <i class="fas fa-code me-1"></i>Incorporar Formulário Existente
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- LGPD/Privacy Compliance -->
                                        <div class="alert alert-info border-0 mt-3">
                                            <h6 class="alert-heading mb-2">
                                                <i class="fas fa-shield-alt me-2"></i>Privacidade e Proteção de Dados
                                            </h6>
                                            <small>
                                                ✅ <strong>Dados seguros:</strong> Credenciais do Google Calendar são criptografadas<br>
                                                ✅ <strong>Controle total:</strong> Você pode desconectar sua conta a qualquer momento<br>
                                                ✅ <strong>LGPD/GDPR:</strong> Estamos em conformidade com as leis de proteção de dados<br>
                                                ✅ <strong>Acesso limitado:</strong> Apenas eventos relacionados aos agendamentos são sincronizados
                                            </small>
                                            <div class="mt-2">
                                                <a href="https://support.google.com/calendar/answer/37100" target="_blank" class="btn btn-sm btn-outline-info me-2">
                                                    <i class="fas fa-external-link-alt me-1"></i>Como funciona o Google Calendar
                                                </a>
                                                <a href="https://support.google.com/accounts/answer/3466521" target="_blank" class="btn btn-sm btn-outline-info">
                                                    <i class="fas fa-external-link-alt me-1"></i>Gerenciar permissões do Google
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <div class="d-flex flex-column flex-md-row w-100 gap-2">
                        <button type="button" class="btn btn-secondary flex-fill flex-md-grow-0 order-1 order-md-0" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </button>
                        <button type="button" class="btn btn-outline-info flex-fill flex-md-grow-0 order-0 order-md-1" onclick="previewProfessionalSchedule()">
                            <i class="fas fa-eye me-2"></i><span class="d-none d-md-inline">Visualizar Agenda</span><span class="d-md-none">Ver Agenda</span>
                        </button>
                        <button type="button" class="btn btn-primary flex-fill flex-md-grow-0 order-0 order-md-2" onclick="saveProfessional()">
                            <i class="fas fa-save me-2"></i><span class="d-none d-md-inline">Salvar Profissional</span><span class="d-md-none">Salvar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar View Modal -->
    <div class="modal fade" id="calendarViewModal" tabindex="-1" aria-labelledby="calendarViewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarViewModalLabel">
                        <i class="fas fa-calendar me-2"></i>Calendário - <span id="calendarProfessionalName">Profissional</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-primary active" onclick="changeCalendarView('week')">Semana</button>
                                <button type="button" class="btn btn-outline-primary" onclick="changeCalendarView('month')">Mês</button>
                                <button type="button" class="btn btn-outline-primary" onclick="changeCalendarView('day')">Dia</button>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button type="button" class="btn btn-outline-success" onclick="addAppointmentFromCalendar()">
                                <i class="fas fa-plus me-1"></i>Novo Agendamento
                            </button>
                        </div>
                    </div>
                    
                    <div id="professionalCalendarContainer">
                        <!-- Calendar will be loaded here -->
                        <div class="text-center p-5">
                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                            <p>Carregando calendário...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Fechar
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="syncCalendarNow()">
                        <i class="fas fa-sync me-2"></i>Sincronizar Agora
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="exportCalendarData()">
                        <i class="fas fa-download me-2"></i>Exportar Agenda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/utils/secure-auth.js"></script>
    <script src="js/utils/context-manager.js"></script>
    <script>
        // Global variables
        let currentProfessionalData = {};
        let servicesData = [];
        let currentIntervals = {};
        let currentExceptions = [];
        let currentProfessionalId = null;
        
        // ==================== SERVICES MANAGEMENT ====================
        
        async function loadServices() {
            try {
                const response = await fetch('/api/admin/services', {
                    headers: {
                        'Authorization': getAuthToken()
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    servicesData = data.services || [];
                    servicesData.sort((a, b) => a.name.localeCompare(b.name));
                    populateServicesDropdown();
                } else {
                    console.error('Erro ao carregar serviços');
                    servicesData = [
                        { id: 1, name: 'Corte Feminino' },
                        { id: 2, name: 'Corte Masculino' },
                        { id: 3, name: 'Manicure' },
                        { id: 4, name: 'Pedicure' },
                        { id: 5, name: 'Limpeza de Pele' },
                        { id: 6, name: 'Escova' },
                        { id: 7, name: 'Barba' },
                        { id: 8, name: 'Coloração' }
                    ];
                    populateServicesDropdown();
                }
            } catch (error) {
                console.error('Erro ao carregar serviços:', error);
                servicesData = [
                    { id: 1, name: 'Corte Feminino' },
                    { id: 2, name: 'Corte Masculino' },
                    { id: 3, name: 'Manicure' },
                    { id: 4, name: 'Pedicure' },
                    { id: 5, name: 'Limpeza de Pele' },
                    { id: 6, name: 'Escova' },
                    { id: 7, name: 'Barba' },
                    { id: 8, name: 'Coloração' }
                ];
                populateServicesDropdown();
            }
        }
        
        function populateServicesDropdown() {
            const dropdown = document.getElementById('editProfessionalServices');
            dropdown.innerHTML = '';
            
            servicesData.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = service.name;
                dropdown.appendChild(option);
            });
        }
        
        function selectProfessionalServices(specialtiesString) {
            const dropdown = document.getElementById('editProfessionalServices');
            const specialties = specialtiesString ? specialtiesString.split(',').map(s => s.trim()) : [];
            
            for (let option of dropdown.options) {
                option.selected = false;
            }
            
            specialties.forEach(specialty => {
                for (let option of dropdown.options) {
                    if (option.textContent === specialty) {
                        option.selected = true;
                        break;
                    }
                }
            });
        }
        
        // ==================== PROFESSIONAL MANAGEMENT ====================
        
        function viewProfessional(id, name, email, phone, specialties, status, bio) {
            currentProfessionalData = { id, name, email, phone, specialties, status, bio };
            
            document.getElementById('viewProfessionalName').textContent = name;
            document.getElementById('viewProfessionalEmail').textContent = email;
            document.getElementById('viewProfessionalPhone').textContent = phone;
            document.getElementById('viewProfessionalStatus').innerHTML = getStatusBadge(status);
            document.getElementById('viewProfessionalSpecialties').innerHTML = getSpecialtiesBadges(specialties);
            document.getElementById('viewProfessionalBio').textContent = bio;
            
            // Load calendar data
            loadProfessionalCalendarData(id, true);
            
            const modal = new bootstrap.Modal(document.getElementById('viewProfessionalModal'));
            modal.show();
        }
        
        function editProfessional(id, name, email, phone, specialties, status, bio) {
            currentProfessionalData = { id, name, email, phone, specialties, status, bio };
            currentProfessionalId = id;
            
            document.getElementById('editProfessionalId').value = id;
            document.getElementById('editProfessionalName').value = name;
            document.getElementById('editProfessionalEmail').value = email;
            document.getElementById('editProfessionalPhone').value = phone;
            document.getElementById('editProfessionalBio').value = bio;
            
            const statusValue = getStatusValue(status);
            document.getElementById('editProfessionalStatus').value = statusValue;
            
            selectProfessionalServices(specialties);
            
            // Reset to basic schedule tab
            const basicTab = new bootstrap.Tab(document.getElementById('basic-schedule-tab'));
            basicTab.show();
            
            document.getElementById('editProfessionalModalLabel').innerHTML = 
                '<i class="fas fa-edit me-2"></i>Editar Profissional';
            
            // Load calendar data
            loadProfessionalCalendarData(id);
            
            const modal = new bootstrap.Modal(document.getElementById('editProfessionalModal'));
            modal.show();
        }
        
        function addProfessional() {
            document.getElementById('editProfessionalForm').reset();
            document.getElementById('editProfessionalId').value = 'new';
            currentProfessionalId = 'new';
            
            // Reset intervals and exceptions
            currentIntervals = {};
            currentExceptions = [];
            
            // Reset to basic schedule tab
            const basicTab = new bootstrap.Tab(document.getElementById('basic-schedule-tab'));
            basicTab.show();
            
            document.getElementById('editProfessionalModalLabel').innerHTML = 
                '<i class="fas fa-plus me-2"></i>Novo Profissional';
            
            // Show working hours section for new professionals
            updateCalendarConnectionStatus('disconnected');
            
            const modal = new bootstrap.Modal(document.getElementById('editProfessionalModal'));
            modal.show();
        }
        
        function editProfessionalFromView() {
            const viewModal = bootstrap.Modal.getInstance(document.getElementById('viewProfessionalModal'));
            viewModal.hide();
            
            setTimeout(() => {
                const { id, name, email, phone, specialties, status, bio } = currentProfessionalData;
                editProfessional(id, name, email, phone, specialties, status, bio);
            }, 300);
        }
        
        async function saveProfessional() {
            const form = document.getElementById('editProfessionalForm');
            const formData = new FormData(form);
            
            const servicesDropdown = document.getElementById('editProfessionalServices');
            const selectedServices = Array.from(servicesDropdown.selectedOptions).map(option => option.textContent);
            
            const workingHours = getWorkingHours();
            const advancedSchedule = getAdvancedSchedule();
            
            const professionalData = {
                id: formData.get('professionalId'),
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                specialties: selectedServices,
                status: formData.get('status'),
                bio: formData.get('bio'),
                working_hours: workingHours,
                advanced_schedule: advancedSchedule,
                intervals: currentIntervals,
                exceptions: currentExceptions
            };
            
            try {
                const isNew = professionalData.id === 'new';
                const url = isNew ? '/api/admin/professionals' : `/api/admin/professionals/${professionalData.id}`;
                const method = isNew ? 'POST' : 'PUT';
                
                console.log('Salvando profissional:', professionalData);
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': getAuthToken()
                    },
                    body: JSON.stringify(professionalData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editProfessionalModal'));
                    modal.hide();
                    
                    const action = isNew ? 'criado' : 'atualizado';
                    showSuccessMessage(`Profissional ${action} com sucesso!`);
                    
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Erro ao salvar profissional');
                }
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                showErrorMessage(`Erro ao salvar profissional: ${error.message}`);
            }
        }
        
        // ==================== SCHEDULE MANAGEMENT ====================
        
        function toggleDaySchedule(day) {
            const checkbox = document.getElementById(`working${day}`);
            const startInput = document.getElementById(`working${day}Start`);
            const endInput = document.getElementById(`working${day}End`);
            const intervalsContainer = document.getElementById(`working${day}Intervals`);
            
            if (checkbox.checked) {
                startInput.disabled = false;
                endInput.disabled = false;
                if (intervalsContainer) {
                    intervalsContainer.style.display = 'block';
                }
            } else {
                startInput.disabled = true;
                endInput.disabled = true;
                if (intervalsContainer) {
                    intervalsContainer.style.display = 'none';
                }
            }
        }
        
        function addInterval(day) {
            const intervalsContainer = document.getElementById(`working${day}Intervals`);
            if (!intervalsContainer) return;
            
            if (!currentIntervals[day]) {
                currentIntervals[day] = [];
            }
            
            const intervalId = `${day}_${Date.now()}`;
            const intervalData = {
                id: intervalId,
                type: 'break',
                start: '12:00',
                end: '13:00',
                name: 'Almoço'
            };
            
            currentIntervals[day].push(intervalData);
            
            if (intervalsContainer.style.display === 'none') {
                intervalsContainer.style.display = 'block';
            }
            
            if (!intervalsContainer.querySelector('.interval-controls')) {
                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'interval-controls';
                controlsDiv.innerHTML = `
                    <h6><i class="fas fa-pause-circle me-2"></i>Intervalos e Pausas</h6>
                `;
                intervalsContainer.appendChild(controlsDiv);
            }
            
            const intervalElement = document.createElement('div');
            intervalElement.className = 'interval-item break-interval';
            intervalElement.id = intervalId;
            intervalElement.innerHTML = `
                <div class="row align-items-center">
                    <div class="col-md-3">
                        <select class="form-select form-select-sm" onchange="updateIntervalType('${intervalId}', this.value)">
                            <option value="break">Pausa/Almoço</option>
                            <option value="work">Período de Trabalho</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="time" class="form-control form-control-sm" value="${intervalData.start}" 
                               onchange="updateIntervalTime('${intervalId}', 'start', this.value)">
                    </div>
                    <div class="col-md-1 text-center"><small>até</small></div>
                    <div class="col-md-2">
                        <input type="time" class="form-control form-control-sm" value="${intervalData.end}"
                               onchange="updateIntervalTime('${intervalId}', 'end', this.value)">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control form-control-sm" value="${intervalData.name}" 
                               placeholder="Nome do intervalo" onchange="updateIntervalName('${intervalId}', this.value)">
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeInterval('${intervalId}', '${day}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            const controlsContainer = intervalsContainer.querySelector('.interval-controls');
            controlsContainer.appendChild(intervalElement);
        }
        
        function removeInterval(intervalId, day) {
            if (currentIntervals[day]) {
                currentIntervals[day] = currentIntervals[day].filter(interval => interval.id !== intervalId);
            }
            
            const intervalElement = document.getElementById(intervalId);
            if (intervalElement) {
                intervalElement.remove();
            }
        }
        
        function updateIntervalType(intervalId, type) {
            const day = intervalId.split('_')[0];
            const interval = currentIntervals[day]?.find(i => i.id === intervalId);
            if (interval) {
                interval.type = type;
                
                const element = document.getElementById(intervalId);
                element.className = 'interval-item';
                if (type === 'break') {
                    element.classList.add('break-interval');
                } else if (type === 'work') {
                    element.classList.add('work-interval');
                }
            }
        }
        
        function updateIntervalTime(intervalId, timeType, value) {
            const day = intervalId.split('_')[0];
            const interval = currentIntervals[day]?.find(i => i.id === intervalId);
            if (interval) {
                interval[timeType] = value;
            }
        }
        
        function updateIntervalName(intervalId, name) {
            const day = intervalId.split('_')[0];
            const interval = currentIntervals[day]?.find(i => i.id === intervalId);
            if (interval) {
                interval.name = name;
            }
        }
        
        function copyScheduleToAll() {
            const monCheckbox = document.getElementById('workingMon');
            const monStart = document.getElementById('workingMonStart').value;
            const monEnd = document.getElementById('workingMonEnd').value;
            
            const days = ['Tue', 'Wed', 'Thu', 'Fri'];
            
            days.forEach(day => {
                const checkbox = document.getElementById(`working${day}`);
                const startInput = document.getElementById(`working${day}Start`);
                const endInput = document.getElementById(`working${day}End`);
                
                if (checkbox && startInput && endInput) {
                    checkbox.checked = monCheckbox.checked;
                    startInput.value = monStart;
                    endInput.value = monEnd;
                    toggleDaySchedule(day);
                }
            });
            
            showSuccessMessage('Horários de segunda-feira copiados para os demais dias úteis!');
        }
        
        function setBusinessHours() {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            
            days.forEach(day => {
                const checkbox = document.getElementById(`working${day}`);
                const startInput = document.getElementById(`working${day}Start`);
                const endInput = document.getElementById(`working${day}End`);
                
                if (checkbox && startInput && endInput) {
                    checkbox.checked = true;
                    startInput.value = '09:00';
                    endInput.value = '18:00';
                    toggleDaySchedule(day);
                }
            });
            
            // Weekend
            ['Sat', 'Sun'].forEach(day => {
                const checkbox = document.getElementById(`working${day}`);
                if (checkbox) {
                    checkbox.checked = false;
                    toggleDaySchedule(day);
                }
            });
            
            showSuccessMessage('Horário comercial (9h às 18h) aplicado aos dias úteis!');
        }
        
        function previewSchedule() {
            const preview = document.getElementById('schedulePreview');
            const content = document.getElementById('schedulePreviewContent');
            
            const workingHours = getWorkingHours();
            let previewHtml = '';
            
            const dayNames = {
                'mon': 'Segunda-feira',
                'tue': 'Terça-feira', 
                'wed': 'Quarta-feira',
                'thu': 'Quinta-feira',
                'fri': 'Sexta-feira',
                'sat': 'Sábado',
                'sun': 'Domingo'
            };
            
            for (const [day, data] of Object.entries(workingHours)) {
                const dayName = dayNames[day];
                if (data.enabled) {
                    previewHtml += `<div class="mb-2">
                        <strong>${dayName}:</strong> ${data.start} às ${data.end}`;
                    
                    if (currentIntervals[day.charAt(0).toUpperCase() + day.slice(1)] && 
                        currentIntervals[day.charAt(0).toUpperCase() + day.slice(1)].length > 0) {
                        previewHtml += '<br><small class="text-muted ms-3">Intervalos: ';
                        const intervals = currentIntervals[day.charAt(0).toUpperCase() + day.slice(1)];
                        previewHtml += intervals.map(i => `${i.name} (${i.start}-${i.end})`).join(', ');
                        previewHtml += '</small>';
                    }
                    
                    previewHtml += '</div>';
                } else {
                    previewHtml += `<div class="mb-2 text-muted">
                        <strong>${dayName}:</strong> Não trabalha
                    </div>`;
                }
            }
            
            content.innerHTML = previewHtml || 'Nenhum horário configurado';
            preview.style.display = 'block';
        }
        
        function getWorkingHours() {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const workingHours = {};
            
            days.forEach(day => {
                const checkbox = document.getElementById(`working${day}`);
                const startInput = document.getElementById(`working${day}Start`);
                const endInput = document.getElementById(`working${day}End`);
                
                workingHours[day.toLowerCase()] = {
                    enabled: checkbox ? checkbox.checked : false,
                    start: startInput ? startInput.value : '09:00',
                    end: endInput ? endInput.value : '18:00'
                };
            });
            
            return workingHours;
        }
        
        function loadWorkingHours(workingHours) {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const dayNames = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
            
            let viewContent = '';
            
            days.forEach((day, index) => {
                const dayData = workingHours[day.toLowerCase()];
                const checkbox = document.getElementById(`working${day}`);
                const startInput = document.getElementById(`working${day}Start`);
                const endInput = document.getElementById(`working${day}End`);
                
                if (dayData && dayData.enabled) {
                    if (checkbox) checkbox.checked = true;
                    if (startInput) startInput.value = dayData.start || '09:00';
                    if (endInput) endInput.value = dayData.end || '18:00';
                    
                    viewContent += `<strong>${dayNames[index]}:</strong> ${dayData.start} às ${dayData.end}<br>`;
                    toggleDaySchedule(day);
                } else {
                    if (checkbox) checkbox.checked = false;
                    viewContent += `<span class="text-muted">${dayNames[index]}: Não trabalha</span><br>`;
                    toggleDaySchedule(day);
                }
            });
            
            const viewWorkingHoursContent = document.getElementById('viewWorkingHoursContent');
            if (viewWorkingHoursContent) {
                viewWorkingHoursContent.innerHTML = viewContent || 'Não configurado';
            }
        }
        
        // ==================== ADVANCED SCHEDULE ====================
        
        function getAdvancedSchedule() {
            const periodType = document.getElementById('advancedPeriodType')?.value;
            const applyTo = document.getElementById('advancedApplyTo')?.value;
            const startDate = document.getElementById('advancedStartDate')?.value;
            const endDate = document.getElementById('advancedEndDate')?.value;
            const multiplePeriods = document.getElementById('enableMultiplePeriods')?.checked;
            
            return {
                enabled: periodType !== 'weekly',
                period_type: periodType,
                apply_to: applyTo,
                start_date: startDate,
                end_date: endDate,
                multiple_periods: multiplePeriods,
                exceptions: currentExceptions
            };
        }
        
        function addException() {
            const exceptionId = `exception_${Date.now()}`;
            const exceptionData = {
                id: exceptionId,
                date: '',
                type: 'closed',
                name: 'Feriado',
                start_time: null,
                end_time: null
            };
            
            currentExceptions.push(exceptionData);
            
            const exceptionsList = document.getElementById('exceptionsList');
            
            if (exceptionsList.querySelector('small')) {
                exceptionsList.innerHTML = '';
            }
            
            const exceptionElement = document.createElement('div');
            exceptionElement.className = 'interval-item';
            exceptionElement.id = exceptionId;
            exceptionElement.innerHTML = `
                <div class="row align-items-center">
                    <div class="col-md-2">
                        <input type="date" class="form-control form-control-sm" 
                               onchange="updateException('${exceptionId}', 'date', this.value)" required>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select form-select-sm" onchange="updateException('${exceptionId}', 'type', this.value)">
                            <option value="closed">Fechado</option>
                            <option value="custom">Horário Especial</option>
                            <option value="holiday">Feriado</option>
                        </select>
                    </div>
                    <div class="col-md-2" id="${exceptionId}_time_start" style="display: none;">
                        <input type="time" class="form-control form-control-sm" 
                               onchange="updateException('${exceptionId}', 'start_time', this.value)">
                    </div>
                    <div class="col-md-1 text-center" id="${exceptionId}_time_separator" style="display: none;">
                        <small>até</small>
                    </div>
                    <div class="col-md-2" id="${exceptionId}_time_end" style="display: none;">
                        <input type="time" class="form-control form-control-sm" 
                               onchange="updateException('${exceptionId}', 'end_time', this.value)">
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control form-control-sm" value="${exceptionData.name}" 
                               placeholder="Nome da exceção" onchange="updateException('${exceptionId}', 'name', this.value)">
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeException('${exceptionId}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            exceptionsList.appendChild(exceptionElement);
        }
        
        function removeException(exceptionId) {
            currentExceptions = currentExceptions.filter(exc => exc.id !== exceptionId);
            
            const exceptionElement = document.getElementById(exceptionId);
            if (exceptionElement) {
                exceptionElement.remove();
            }
            
            const exceptionsList = document.getElementById('exceptionsList');
            if (exceptionsList.children.length === 0) {
                exceptionsList.innerHTML = '<small class="text-muted">Nenhuma exceção configurada</small>';
            }
        }
        
        function updateException(exceptionId, field, value) {
            const exception = currentExceptions.find(exc => exc.id === exceptionId);
            if (exception) {
                exception[field] = value;
                
                if (field === 'type') {
                    const startElement = document.getElementById(`${exceptionId}_time_start`);
                    const separatorElement = document.getElementById(`${exceptionId}_time_separator`);
                    const endElement = document.getElementById(`${exceptionId}_time_end`);
                    
                    if (value === 'custom') {
                        startElement.style.display = 'block';
                        separatorElement.style.display = 'block';
                        endElement.style.display = 'block';
                    } else {
                        startElement.style.display = 'none';
                        separatorElement.style.display = 'none';
                        endElement.style.display = 'none';
                    }
                }
            }
        }
        
        function importHolidays() {
            // This would typically fetch holidays from an API
            const holidays = [
                { date: '2024-01-01', name: 'Confraternização Universal' },
                { date: '2024-04-21', name: 'Tiradentes' },
                { date: '2024-05-01', name: 'Dia do Trabalhador' },
                { date: '2024-09-07', name: 'Independência do Brasil' },
                { date: '2024-10-12', name: 'Nossa Senhora Aparecida' },
                { date: '2024-11-02', name: 'Finados' },
                { date: '2024-11-15', name: 'Proclamação da República' },
                { date: '2024-12-25', name: 'Natal' }
            ];
            
            holidays.forEach(holiday => {
                const exceptionId = `holiday_${holiday.date}`;
                const exceptionData = {
                    id: exceptionId,
                    date: holiday.date,
                    type: 'holiday',
                    name: holiday.name,
                    start_time: null,
                    end_time: null
                };
                
                // Check if already exists
                if (!currentExceptions.find(exc => exc.date === holiday.date)) {
                    currentExceptions.push(exceptionData);
                }
            });
            
            refreshExceptionsList();
            showSuccessMessage('Feriados nacionais importados com sucesso!');
        }
        
        function refreshExceptionsList() {
            const exceptionsList = document.getElementById('exceptionsList');
            exceptionsList.innerHTML = '';
            
            if (currentExceptions.length === 0) {
                exceptionsList.innerHTML = '<small class="text-muted">Nenhuma exceção configurada</small>';
                return;
            }
            
            currentExceptions.forEach(exception => {
                const exceptionElement = document.createElement('div');
                exceptionElement.className = 'interval-item';
                exceptionElement.id = exception.id;
                exceptionElement.innerHTML = `
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <input type="date" class="form-control form-control-sm" value="${exception.date || ''}"
                                   onchange="updateException('${exception.id}', 'date', this.value)" required>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select form-select-sm" onchange="updateException('${exception.id}', 'type', this.value)">
                                <option value="closed" ${exception.type === 'closed' ? 'selected' : ''}>Fechado</option>
                                <option value="custom" ${exception.type === 'custom' ? 'selected' : ''}>Horário Especial</option>
                                <option value="holiday" ${exception.type === 'holiday' ? 'selected' : ''}>Feriado</option>
                            </select>
                        </div>
                        <div class="col-md-2" id="${exception.id}_time_start" style="display: ${exception.type === 'custom' ? 'block' : 'none'};">
                            <input type="time" class="form-control form-control-sm" value="${exception.start_time || ''}"
                                   onchange="updateException('${exception.id}', 'start_time', this.value)">
                        </div>
                        <div class="col-md-1 text-center" id="${exception.id}_time_separator" style="display: ${exception.type === 'custom' ? 'block' : 'none'};">
                            <small>até</small>
                        </div>
                        <div class="col-md-2" id="${exception.id}_time_end" style="display: ${exception.type === 'custom' ? 'block' : 'none'};">
                            <input type="time" class="form-control form-control-sm" value="${exception.end_time || ''}"
                                   onchange="updateException('${exception.id}', 'end_time', this.value)">
                        </div>
                        <div class="col-md-2">
                            <input type="text" class="form-control form-control-sm" value="${exception.name || ''}"
                                   placeholder="Nome da exceção" onchange="updateException('${exception.id}', 'name', this.value)">
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeException('${exception.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                exceptionsList.appendChild(exceptionElement);
            });
        }
        
        function saveAdvancedSchedule() {
            showSuccessMessage('Configuração avançada salva! Lembre-se de salvar o profissional.');
        }
        
        // ==================== GOOGLE CALENDAR INTEGRATION ====================
        
        async function connectGoogleCalendar() {
            const professionalId = document.getElementById('editProfessionalId').value;
            const professionalName = document.getElementById('editProfessionalName').value;
            
            if (!professionalId || professionalId === 'new') {
                showErrorMessage('Salve o profissional primeiro antes de conectar o Google Calendar.');
                return;
            }
            
            localStorage.setItem('currentProfessionalId', professionalId);
            localStorage.setItem('currentProfessionalName', professionalName);
            localStorage.setItem('calendarAuthReturnUrl', window.location.href);
            
            const authUrl = `google-calendar-authorization.html?professionalId=${professionalId}&professionalName=${encodeURIComponent(professionalName)}`;
            window.open(authUrl, 'GoogleCalendarAuth', 'width=600,height=700,scrollbars=yes,resizable=yes');
        }
        
        async function disconnectGoogleCalendar() {
            const professionalId = document.getElementById('editProfessionalId').value;
            
            if (!confirm('Tem certeza que deseja desconectar o Google Calendar? A sincronização automática será interrompida.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/professionals/${professionalId}/disconnect-calendar`, {
                    method: 'POST',
                    headers: {
                        'Authorization': getAuthToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    showSuccessMessage('Google Calendar desconectado com sucesso!');
                    updateCalendarConnectionStatus('disconnected');
                } else {
                    throw new Error('Erro ao desconectar Google Calendar');
                }
            } catch (error) {
                console.error('Erro ao desconectar Google Calendar:', error);
                showErrorMessage('Erro ao desconectar Google Calendar');
            }
        }
        
        async function testGoogleCalendar() {
            const professionalId = document.getElementById('editProfessionalId').value;
            
            if (!professionalId || professionalId === 'new') {
                showErrorMessage('Profissional deve estar salvo para testar a conexão.');
                return;
            }
            
            try {
                showSuccessMessage('Testando conexão com Google Calendar...');
                
                const response = await fetch(`/api/admin/professionals/${professionalId}/test-calendar`, {
                    method: 'POST',
                    headers: {
                        'Authorization': getAuthToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showSuccessMessage(`✅ Conexão funcionando! ${result.message || 'Calendário conectado corretamente'}`);
                } else {
                    throw new Error(result.message || 'Erro no teste de conexão');
                }
            } catch (error) {
                console.error('Erro ao testar Google Calendar:', error);
                showErrorMessage(`❌ Erro no teste: ${error.message}`);
            }
        }
        
        function updateCalendarConnectionStatus(status, calendarId = null) {
            const statusElement = document.getElementById('calendarConnectionStatus');
            const infoElement = document.getElementById('calendarConnectionInfo');
            const connectBtn = document.getElementById('connectCalendarBtn');
            const disconnectBtn = document.getElementById('disconnectCalendarBtn');
            const testBtn = document.getElementById('testCalendarBtn');
            const googleCalendarOptions = document.getElementById('googleCalendarOptions');
            
            // View modal elements
            const viewCalendarStatus = document.getElementById('viewCalendarStatus');
            const viewCalendarId = document.getElementById('viewCalendarId');
            
            switch (status) {
                case 'connected':
                    statusElement.className = 'badge bg-success ms-2';
                    statusElement.textContent = 'Conectado';
                    infoElement.textContent = `Sincronização ativa com o calendário: ${calendarId || 'primary'}`;
                    connectBtn.style.display = 'none';
                    disconnectBtn.style.display = 'inline-block';
                    testBtn.style.display = 'inline-block';
                    if (googleCalendarOptions) googleCalendarOptions.style.display = 'block';
                    
                    // Update calendar embed
                    updateCalendarEmbed(calendarId);
                    
                    // Update view modal
                    if (viewCalendarStatus) {
                        viewCalendarStatus.innerHTML = '<span class="badge bg-success">Conectado</span>';
                        viewCalendarId.textContent = calendarId || 'primary';
                    }
                    break;
                    
                case 'disconnected':
                    statusElement.className = 'badge bg-secondary ms-2';
                    statusElement.textContent = 'Não configurado';
                    infoElement.textContent = 'Para sincronizar agendamentos automaticamente com o Google Calendar, conecte sua conta.';
                    connectBtn.style.display = 'inline-block';
                    disconnectBtn.style.display = 'none';
                    testBtn.style.display = 'none';
                    if (googleCalendarOptions) googleCalendarOptions.style.display = 'none';
                    
                    // Update view modal
                    if (viewCalendarStatus) {
                        viewCalendarStatus.innerHTML = '<span class="badge bg-secondary">Não configurado</span>';
                        viewCalendarId.textContent = '-';
                    }
                    break;
                    
                case 'error':
                    statusElement.className = 'badge bg-danger ms-2';
                    statusElement.textContent = 'Erro na conexão';
                    infoElement.textContent = 'Problema na conexão com o Google Calendar. Teste a conexão ou reconecte.';
                    connectBtn.style.display = 'inline-block';
                    disconnectBtn.style.display = 'inline-block';
                    testBtn.style.display = 'inline-block';
                    if (googleCalendarOptions) googleCalendarOptions.style.display = 'block';
                    
                    // Update view modal
                    if (viewCalendarStatus) {
                        viewCalendarStatus.innerHTML = '<span class="badge bg-danger">Erro na conexão</span>';
                        viewCalendarId.textContent = calendarId || '-';
                    }
                    break;
                    
                default:
                    connectBtn.style.display = 'inline-block';
                    disconnectBtn.style.display = 'none';
                    testBtn.style.display = 'none';
                    if (googleCalendarOptions) googleCalendarOptions.style.display = 'none';
            }
        }
        
        function updateCalendarEmbed(calendarId) {
            const iframe = document.getElementById('googleCalendarFrame');
            if (iframe && calendarId) {
                const embedUrl = `https://calendar.google.com/calendar/embed?src=${encodeURIComponent(calendarId)}&ctz=America/Sao_Paulo&mode=WEEK&showTitle=0&showNav=1&showDate=1&showPrint=0&showTabs=0&showCalendars=0&showTz=0`;
                iframe.src = embedUrl;
            }
        }
        
        function refreshCalendarEmbed() {
            const iframe = document.getElementById('googleCalendarFrame');
            if (iframe && iframe.src) {
                iframe.src = iframe.src;
                showSuccessMessage('Calendário atualizado!');
            }
        }
        
        function openGoogleCalendar() {
            const calendarId = document.getElementById('viewCalendarId')?.textContent || 'primary';
            const url = `https://calendar.google.com/calendar/u/0/r?cid=${encodeURIComponent(calendarId)}`;
            window.open(url, '_blank');
        }
        
        function createGoogleForm() {
            showSuccessMessage('Redirecionando para o Google Forms...');
            window.open('https://docs.google.com/forms/create', '_blank');
        }
        
        function embedGoogleForm() {
            const formUrl = prompt('Cole o URL do Google Form que deseja incorporar:');
            if (formUrl) {
                showSuccessMessage('Funcionalidade em desenvolvimento. Form URL: ' + formUrl);
            }
        }
        
        async function loadProfessionalCalendarData(professionalId, isViewMode = false) {
            if (!professionalId || professionalId === 'new') {
                updateCalendarConnectionStatus('disconnected');
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/professionals/${professionalId}/calendar-status`, {
                    headers: {
                        'Authorization': getAuthToken()
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.connected) {
                        updateCalendarConnectionStatus('connected', data.calendar_id);
                        
                        if (data.working_hours && !isViewMode) {
                            loadWorkingHours(data.working_hours);
                        }
                        
                        if (data.intervals) {
                            currentIntervals = data.intervals;
                        }
                        
                        if (data.exceptions) {
                            currentExceptions = data.exceptions;
                            refreshExceptionsList();
                        }
                    } else {
                        updateCalendarConnectionStatus('disconnected');
                    }
                } else {
                    updateCalendarConnectionStatus('error');
                }
            } catch (error) {
                console.error('Erro ao carregar dados do calendário:', error);
                updateCalendarConnectionStatus('error');
            }
        }
        
        // ==================== CALENDAR VIEW MODAL ====================
        
        function viewCalendar(professionalId, professionalName) {
            currentProfessionalId = professionalId;
            document.getElementById('calendarProfessionalName').textContent = professionalName;
            
            const modal = new bootstrap.Modal(document.getElementById('calendarViewModal'));
            modal.show();
            
            loadProfessionalCalendar(professionalId);
        }
        
        function viewProfessionalCalendar() {
            if (currentProfessionalData && currentProfessionalData.id) {
                viewCalendar(currentProfessionalData.id, currentProfessionalData.name);
            }
        }
        
        async function loadProfessionalCalendar(professionalId) {
            const container = document.getElementById('professionalCalendarContainer');
            
            try {
                // Load calendar data
                const response = await fetch(`/api/admin/professionals/${professionalId}/calendar-data`, {
                    headers: {
                        'Authorization': getAuthToken()
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Render calendar (this would typically use a calendar library like FullCalendar)
                    container.innerHTML = `
                        <div class="calendar-view">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6><i class="fas fa-calendar-week me-2"></i>Agenda da Semana</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="text-center p-4">
                                                <i class="fas fa-calendar-alt fa-3x text-muted mb-3"></i>
                                                <p class="text-muted">Integração com biblioteca de calendário em desenvolvimento</p>
                                                <small>Os agendamentos aparecerão aqui quando a integração estiver completa</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6><i class="fas fa-clock me-2"></i>Horários de Trabalho</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="calendarWorkingHours">
                                                ${data.working_hours_display || 'Não configurado'}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card mt-3">
                                        <div class="card-header">
                                            <h6><i class="fas fa-chart-bar me-2"></i>Estatísticas</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row text-center">
                                                <div class="col-6">
                                                    <div class="metric-value text-primary">${data.stats?.appointments_today || 0}</div>
                                                    <div class="metric-title">Hoje</div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="metric-value text-success">${data.stats?.appointments_week || 0}</div>
                                                    <div class="metric-title">Esta Semana</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error('Erro ao carregar dados do calendário');
                }
            } catch (error) {
                console.error('Erro ao carregar calendário:', error);
                container.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Erro ao carregar calendário: ${error.message}
                    </div>
                `;
            }
        }
        
        function changeCalendarView(view) {
            // Remove active class from all buttons
            document.querySelectorAll('#calendarViewModal .btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            showSuccessMessage(`Visualização alterada para: ${view}`);
        }
        
        function addAppointmentFromCalendar() {
            showSuccessMessage('Redirecionando para nova consulta...');
            // This would typically open the appointments page with a pre-filled form
        }
        
        function syncCalendarNow() {
            showSuccessMessage('Sincronizando calendário...');
            
            setTimeout(() => {
                showSuccessMessage('Calendário sincronizado com sucesso!');
                if (currentProfessionalId) {
                    loadProfessionalCalendar(currentProfessionalId);
                }
            }, 2000);
        }
        
        function exportCalendarData() {
            showSuccessMessage('Exportando dados do calendário...');
            // This would generate and download calendar data
        }
        
        // ==================== BULK OPERATIONS ====================
        
        function bulkScheduleUpdate() {
            showSuccessMessage('Funcionalidade de atualização em lote em desenvolvimento');
        }
        
        function exportSchedules() {
            showSuccessMessage('Exportando horários de todos os profissionais...');
            window.open('/api/admin/export/professional-schedules', '_blank');
        }
        
        function previewProfessionalSchedule() {
            previewSchedule();
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        
        function getStatusBadge(status) {
            const badges = {
                'Ativo': '<span class="badge bg-success">Ativo</span>',
                'Inativo': '<span class="badge bg-secondary">Inativo</span>',
                'Férias': '<span class="badge bg-warning">Férias</span>',
                'Licença Médica': '<span class="badge bg-danger">Licença Médica</span>'
            };
            return badges[status] || status;
        }
        
        function getStatusValue(statusText) {
            const statusMap = {
                'Ativo': 'active',
                'Inativo': 'inactive',
                'Férias': 'vacation',
                'Licença Médica': 'sick'
            };
            return statusMap[statusText] || 'active';
        }
        
        function getSpecialtiesBadges(specialtiesString) {
            if (!specialtiesString) return '-';
            
            const specialties = specialtiesString.split(',');
            const colors = ['bg-primary', 'bg-success', 'bg-info', 'bg-warning', 'bg-danger', 'bg-secondary'];
            
            return specialties.map((specialty, index) => {
                const color = colors[index % colors.length];
                return `<span class="badge ${color} me-1">${specialty.trim()}</span>`;
            }).join('');
        }
        
        function getAuthToken() {
            if (window.secureAuth) {
                return window.secureAuth.getAuthHeader();
            }
            return 'Bearer ' + (localStorage.getItem('ubs_token') || localStorage.getItem('adminToken'));
        }
        
        function showSuccessMessage(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show position-fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
        
        function showErrorMessage(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show position-fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        // ==================== MENU FUNCTIONS ====================
        
        function exportData() {
            exportSchedules();
        }
        
        function refreshData() {
            showSuccessMessage('Atualizando lista de profissionais...');
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                if (window.secureAuth) {
                    window.secureAuth.logout();
                } else {
                    localStorage.removeItem('ubs_token');
                    localStorage.removeItem('adminToken');
                }
                window.location.href = 'login.html';
            }
        }
        
        // ==================== EVENT LISTENERS ====================
        
        // Listen for advanced schedule tab changes
        document.addEventListener('DOMContentLoaded', function() {
            if (window.contextManager) {
                window.contextManager.refreshContext();
            }
            
            loadServices();
            
            // Advanced schedule options
            const advancedApplyTo = document.getElementById('advancedApplyTo');
            if (advancedApplyTo) {
                advancedApplyTo.addEventListener('change', function() {
                    const dateRange = document.getElementById('advancedDateRange');
                    const dateRangeEnd = document.getElementById('advancedDateRangeEnd');
                    
                    if (this.value === 'range') {
                        dateRange.style.display = 'block';
                        dateRangeEnd.style.display = 'block';
                    } else {
                        dateRange.style.display = 'none';
                        dateRangeEnd.style.display = 'none';
                    }
                });
            }
            
            // Week selector buttons
            document.querySelectorAll('.week-selector .btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });
            
            // Listen for calendar authorization success
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'GOOGLE_CALENDAR_AUTH_SUCCESS') {
                    const professionalId = event.data.professionalId;
                    showSuccessMessage('Google Calendar conectado com sucesso!');
                    
                    if (professionalId) {
                        loadProfessionalCalendarData(professionalId);
                    }
                }
            });
            
            // Initialize day schedule toggles
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            days.forEach(day => {
                toggleDaySchedule(day);
            });
        });
    </script>
</body>
</html>