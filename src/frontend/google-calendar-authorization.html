<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autoriza√ß√£o Google Calendar - Universal Booking System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .authorization-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .calendar-icon {
            font-size: 4rem;
            color: #4285f4;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .consent-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
            border-left: 4px solid #4285f4;
        }

        .consent-details h3 {
            color: #333;
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-icon {
            color: #ff9800;
            font-size: 1.2em;
        }

        .consent-details ul {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }

        .consent-details li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .consent-details li:last-child {
            border-bottom: none;
        }

        .check-icon {
            color: #28a745;
            font-weight: bold;
        }

        .security-note {
            background: #e8f5e8;
            border: 1px solid #d4edda;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #155724;
        }

        .security-note strong {
            color: #0f5132;
        }

        .authorize-button {
            background: linear-gradient(45deg, #4285f4, #34a853);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
            min-width: 200px;
        }

        .authorize-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
        }

        .cancel-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
            min-width: 200px;
        }

        .cancel-button:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .professional-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }

        .domain-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 10px;
        }

        .domain-healthcare { background: #d4edda; color: #155724; }
        .domain-beauty { background: #cce5ff; color: #004085; }
        .domain-legal { background: #ffe6e6; color: #721c24; }
        .domain-education { background: #fff3cd; color: #856404; }
        .domain-sports { background: #f8d7da; color: #721c24; }
        .domain-consulting { background: #e2e3e5; color: #383d41; }

        @media (max-width: 768px) {
            .authorization-container {
                padding: 20px;
                margin: 10px;
            }
            
            .authorize-button, .cancel-button {
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="authorization-container">
        <div class="calendar-icon">üìÖ</div>
        
        <h1>Conectar Google Calendar</h1>
        <p class="subtitle">Autorize o acesso para sincronizar seus agendamentos</p>

        <div class="professional-info" id="professionalInfo">
            <strong>Profissional:</strong> <span id="professionalName">Carregando...</span>
            <span id="domainBadge" class="domain-badge"></span>
        </div>

        <div class="consent-details">
            <h3>
                <span class="warning-icon">‚ö†Ô∏è</span>
                <strong>Acesso Necess√°rio ao Seu Google Calendar</strong>
            </h3>
            <p>Para funcionar corretamente, nossa plataforma precisar√° acessar as seguintes informa√ß√µes do seu Google Calendar:</p>
            
            <ul>
                <li>
                    <span class="check-icon">‚úÖ</span>
                    <strong>Visualizar seus eventos</strong> - Para detectar conflitos de hor√°rio e evitar agendamentos duplicados
                </li>
                <li>
                    <span class="check-icon">‚úÖ</span>
                    <strong>Criar novos eventos</strong> - Para adicionar automaticamente agendamentos feitos via WhatsApp
                </li>
                <li>
                    <span class="check-icon">‚úÖ</span>
                    <strong>Modificar eventos existentes</strong> - Para atualizar hor√°rios quando agendamentos forem alterados
                </li>
                <li>
                    <span class="check-icon">‚úÖ</span>
                    <strong>Sincronizar mudan√ßas</strong> - Para manter seu calend√°rio sempre atualizado bidirecionalmente
                </li>
                <li>
                    <span class="check-icon">‚úÖ</span>
                    <strong>Armazenar tokens de acesso</strong> - Para manter a conex√£o ativa de forma segura (criptografados)
                </li>
            </ul>
        </div>

        <div class="security-note">
            <strong>üîí Seguran√ßa e Privacidade:</strong><br>
            ‚Ä¢ Seu calend√°rio permanece sob SEU controle total<br>
            ‚Ä¢ Voc√™ pode revogar o acesso a qualquer momento<br>
            ‚Ä¢ Somente eventos relacionados aos seus agendamentos s√£o afetados<br>
            ‚Ä¢ Seus dados s√£o criptografados e protegidos conforme LGPD/GDPR
        </div>

        <div class="button-container">
            <button class="authorize-button" onclick="proceedWithGoogleAuth()">
                üîó Autorizar Acesso ao Meu Google Calendar
            </button>
            <button class="cancel-button" onclick="cancelAuthorization()">
                ‚ùå Cancelar
            </button>
        </div>

        <p style="font-size: 12px; color: #666; margin-top: 20px;">
            Ao autorizar, voc√™ concorda que nossa plataforma acesse seu Google Calendar conforme descrito acima.
            Esta autoriza√ß√£o pode ser revogada a qualquer momento nas configura√ß√µes da sua conta Google.
        </p>
    </div>

    <script>
        // Get professional information from URL parameters or local storage
        function loadProfessionalInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            const professionalId = urlParams.get('professionalId') || localStorage.getItem('currentProfessionalId');
            const professionalName = urlParams.get('professionalName') || localStorage.getItem('currentProfessionalName');
            const domain = urlParams.get('domain') || localStorage.getItem('currentDomain');

            if (professionalName) {
                document.getElementById('professionalName').textContent = professionalName;
                
                if (domain) {
                    const badge = document.getElementById('domainBadge');
                    badge.textContent = domain;
                    badge.className = `domain-badge domain-${domain}`;
                }
            }

            // Store professional ID for authorization
            if (professionalId) {
                localStorage.setItem('authProfessionalId', professionalId);
            }
        }

        function proceedWithGoogleAuth() {
            const professionalId = localStorage.getItem('authProfessionalId');
            
            if (!professionalId) {
                alert('Erro: ID do profissional n√£o encontrado. Tente novamente.');
                return;
            }

            // Show loading state
            const button = document.querySelector('.authorize-button');
            button.innerHTML = '‚è≥ Redirecionando para Google...';
            button.disabled = true;

            // Redirect to Google OAuth
            window.location.href = `/api/google/auth/${professionalId}`;
        }

        function cancelAuthorization() {
            // Return to settings or previous page
            const returnUrl = localStorage.getItem('calendarAuthReturnUrl') || '/settings.html';
            window.location.href = returnUrl;
        }

        // Load professional info on page load
        document.addEventListener('DOMContentLoaded', loadProfessionalInfo);

        // Handle success/error states from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const status = urlParams.get('status');
        
        if (status === 'success') {
            document.querySelector('.authorization-container').innerHTML = `
                <div class="calendar-icon">‚úÖ</div>
                <h1>Autoriza√ß√£o Conclu√≠da!</h1>
                <p class="subtitle">Seu Google Calendar foi conectado com sucesso.</p>
                <div class="security-note">
                    <strong>üéâ Pronto!</strong><br>
                    Agora seus agendamentos ser√£o sincronizados automaticamente com seu Google Calendar.
                </div>
                <button class="authorize-button" onclick="window.location.href='/settings.html'">
                    ‚Üê Voltar √†s Configura√ß√µes
                </button>
            `;
        } else if (status === 'error') {
            document.querySelector('.authorization-container').innerHTML = `
                <div class="calendar-icon">‚ùå</div>
                <h1>Erro na Autoriza√ß√£o</h1>
                <p class="subtitle">N√£o foi poss√≠vel conectar seu Google Calendar.</p>
                <div class="consent-details">
                    <p><strong>Poss√≠veis causas:</strong></p>
                    <ul>
                        <li>‚Ä¢ Autoriza√ß√£o foi cancelada</li>
                        <li>‚Ä¢ Problema de conectividade</li>
                        <li>‚Ä¢ Configura√ß√£o incorreta</li>
                    </ul>
                </div>
                <button class="authorize-button" onclick="window.location.reload()">
                    üîÑ Tentar Novamente
                </button>
                <button class="cancel-button" onclick="window.location.href='/settings.html'">
                    ‚Üê Voltar √†s Configura√ß√µes
                </button>
            `;
        }
    </script>
</body>
</html>