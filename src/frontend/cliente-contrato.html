<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrato | Portal AIC</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --aic-green: #0ECC97;
      --aic-green-dark: #0BA578;
      --aic-green-glow: rgba(14, 204, 151, 0.15);
      --aic-navy: #0C1B33;
      --aic-navy-light: #122444;
      --aic-navy-lighter: #1a3055;
      --aic-white: #FDFDFD;
      --aic-gray: #94a3b8;
      --aic-gray-light: #cbd5e1;
      --aic-border: #1e3a5f;
      --aic-yellow: #F59E0B;
      --aic-danger: #ef4444;
      --sidebar-width: 280px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--aic-navy);
      color: var(--aic-white);
      line-height: 1.7;
    }
    body.has-sidebar { margin-left: var(--sidebar-width); }

    .main-content {
      padding: 40px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Status Banner */
    .status-banner {
      background: var(--aic-green-glow);
      border: 1px solid rgba(14, 204, 151, 0.3);
      border-radius: 12px;
      padding: 16px 24px;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .status-banner.pending {
      background: rgba(245, 158, 11, 0.1);
      border-color: rgba(245, 158, 11, 0.3);
    }
    .status-banner.signed {
      background: var(--aic-green-glow);
      border-color: rgba(14, 204, 151, 0.3);
    }
    .status-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }
    .status-banner.pending .status-icon {
      background: rgba(245, 158, 11, 0.2);
    }
    .status-banner.signed .status-icon {
      background: rgba(14, 204, 151, 0.2);
    }
    .status-text h3 {
      margin: 0 0 4px 0;
      font-size: 16px;
      color: var(--aic-white);
    }
    .status-text p {
      margin: 0;
      font-size: 14px;
      color: var(--aic-gray);
    }

    /* Header */
    .page-header {
      text-align: center;
      padding: 20px 0 40px;
      background: linear-gradient(135deg, var(--aic-navy-light) 0%, var(--aic-navy) 100%);
      border: 1px solid var(--aic-border);
      border-radius: 20px;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
    }
    .page-header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, var(--aic-green-glow) 0%, transparent 50%);
      pointer-events: none;
    }
    .logo {
      width: 140px;
      height: auto;
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }
    .page-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 12px 0;
      color: var(--aic-white);
      position: relative;
      z-index: 1;
    }
    .page-header .subtitle {
      font-size: 15px;
      color: var(--aic-gray);
      margin: 0 0 16px;
      position: relative;
      z-index: 1;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(14, 204, 151, 0.1);
      border: 1px solid rgba(14, 204, 151, 0.3);
      color: var(--aic-green);
      font-size: 13px;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }

    /* Navigation bar */
    .contract-nav {
      position: sticky;
      top: 0;
      background: var(--aic-navy);
      border: 1px solid var(--aic-border);
      border-radius: 12px;
      padding: 12px 20px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      flex-wrap: wrap;
      gap: 12px;
    }
    .contract-nav-info {
      font-size: 14px;
      color: var(--aic-gray);
    }
    .contract-nav-actions {
      display: flex;
      gap: 10px;
    }
    .nav-btn {
      padding: 8px 16px;
      font-size: 13px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }
    .nav-btn-primary {
      background: var(--aic-green);
      color: var(--aic-navy);
      font-weight: 600;
    }
    .nav-btn-secondary {
      background: transparent;
      color: var(--aic-gray);
      border: 1px solid var(--aic-border);
    }
    .nav-btn:hover {
      opacity: 0.9;
    }

    /* Cards */
    .card {
      background: var(--aic-navy-light);
      border: 1px solid var(--aic-border);
      border-radius: 16px;
      padding: 28px;
      margin-bottom: 20px;
    }
    .card h2 {
      margin: 0 0 16px 0;
      font-size: 18px;
      color: var(--aic-green);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--aic-border);
      padding-bottom: 12px;
    }
    .card h3 {
      margin: 20px 0 10px 0;
      font-size: 15px;
      color: var(--aic-white);
    }
    .card p {
      margin: 0 0 14px 0;
      font-size: 14px;
      color: var(--aic-gray-light);
      text-align: justify;
    }
    .card ul, .card ol {
      margin: 0 0 16px 0;
      padding-left: 20px;
    }
    .card li {
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--aic-gray-light);
    }
    .card li strong {
      color: var(--aic-white);
    }
    .clause-number {
      color: var(--aic-green);
      font-weight: 600;
    }

    /* Parties box */
    .parties {
      background: var(--aic-navy);
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
    }
    .party {
      margin-bottom: 16px;
    }
    .party:last-child {
      margin-bottom: 0;
    }
    .party-label {
      font-weight: 700;
      color: var(--aic-green);
      font-size: 13px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .party-data {
      font-size: 14px;
      color: var(--aic-gray-light);
    }
    .party-data strong {
      color: var(--aic-white);
    }

    /* Highlight boxes */
    .highlight-box {
      background: var(--aic-green-glow);
      border: 1px solid rgba(14, 204, 151, 0.3);
      border-left: 4px solid var(--aic-green);
      border-radius: 0 12px 12px 0;
      padding: 16px 20px;
      margin: 20px 0;
    }
    .highlight-box p {
      margin: 0;
      color: var(--aic-white);
      font-size: 14px;
    }
    .highlight-box strong {
      color: var(--aic-green);
    }
    .warning-box {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-left: 4px solid var(--aic-danger);
      border-radius: 0 12px 12px 0;
      padding: 16px 20px;
      margin: 20px 0;
    }
    .warning-box p {
      margin: 0;
      color: var(--aic-gray-light);
      font-size: 14px;
    }
    .warning-box strong {
      color: var(--aic-danger);
    }

    /* Table */
    .contract-table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 13px;
    }
    .contract-table th, .contract-table td {
      border: 1px solid var(--aic-border);
      padding: 12px;
      text-align: left;
    }
    .contract-table th {
      background: var(--aic-navy);
      font-weight: 600;
      color: var(--aic-white);
    }
    .contract-table td {
      color: var(--aic-gray-light);
    }

    /* Form Styles */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--aic-white);
      margin-bottom: 8px;
    }
    .form-input, .form-textarea {
      width: 100%;
      background: var(--aic-navy);
      border: 1px solid var(--aic-border);
      border-radius: 10px;
      padding: 14px 16px;
      font-size: 15px;
      color: var(--aic-white);
      font-family: inherit;
      transition: border-color 0.2s;
    }
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--aic-green);
    }
    .form-input::placeholder, .form-textarea::placeholder {
      color: var(--aic-gray);
    }
    .form-input:disabled, .form-textarea:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }
    .form-hint {
      font-size: 12px;
      color: var(--aic-gray);
      margin-top: 6px;
    }

    /* Signature Section */
    .signature-section {
      background: linear-gradient(135deg, rgba(14, 204, 151, 0.1) 0%, rgba(14, 204, 151, 0.05) 100%);
      border: 2px solid var(--aic-green);
      border-radius: 16px;
      padding: 28px;
      margin-bottom: 20px;
    }
    .signature-section h2 {
      color: var(--aic-green);
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 20px;
    }
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }
    .checkbox-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .checkbox-item input[type="checkbox"] {
      width: 22px;
      height: 22px;
      margin-top: 2px;
      accent-color: var(--aic-green);
      flex-shrink: 0;
      cursor: pointer;
    }
    .checkbox-item label {
      font-size: 14px;
      color: var(--aic-gray-light);
      line-height: 1.5;
      cursor: pointer;
    }
    .digital-signature-box {
      background: var(--aic-navy);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }
    .digital-signature-box h4 {
      color: var(--aic-green);
      margin: 0 0 16px 0;
      font-size: 14px;
    }
    .signature-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      font-size: 12px;
      color: var(--aic-gray);
      margin-top: 16px;
    }
    .signature-info-item {
      background: var(--aic-navy-light);
      padding: 10px 12px;
      border-radius: 8px;
    }
    .signature-info-label {
      color: var(--aic-gray);
      font-size: 10px;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .signature-info-value {
      color: var(--aic-white);
      font-family: monospace;
      font-size: 12px;
    }

    /* Status Messages */
    .status-message {
      padding: 16px;
      border-radius: 10px;
      font-size: 14px;
      margin-top: 20px;
      display: none;
    }
    .status-message.show {
      display: block;
    }
    .status-message.success {
      background: rgba(14, 204, 151, 0.1);
      border: 1px solid rgba(14, 204, 151, 0.3);
      color: var(--aic-green);
    }
    .status-message.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }
    .status-message.loading {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: var(--aic-yellow);
    }

    /* CTA Button */
    .cta-button {
      display: inline-block;
      padding: 16px 32px;
      background: linear-gradient(135deg, var(--aic-green) 0%, var(--aic-green-dark) 100%);
      color: var(--aic-navy);
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
      box-shadow: 0 4px 20px var(--aic-green-glow);
    }
    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px var(--aic-green-glow);
    }
    .cta-button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    /* Already signed section */
    .signed-section {
      text-align: center;
      padding: 32px;
      background: var(--aic-green-glow);
      border: 1px solid rgba(14, 204, 151, 0.3);
      border-radius: 16px;
    }
    .signed-section h3 {
      margin: 0 0 12px 0;
      font-size: 20px;
      color: var(--aic-green);
    }
    .signed-section p {
      margin: 0 0 20px 0;
      color: var(--aic-gray-light);
    }
    .signed-details {
      background: var(--aic-navy);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: left;
    }
    .signed-details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .signed-detail {
      font-size: 13px;
    }
    .signed-detail-label {
      color: var(--aic-gray);
      margin-bottom: 4px;
    }
    .signed-detail-value {
      color: var(--aic-white);
      font-weight: 500;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 30px 20px;
      border-top: 1px solid var(--aic-border);
      margin-top: 30px;
    }
    .footer p {
      font-size: 12px;
      color: var(--aic-gray);
      margin: 0;
    }

    /* Loading */
    .loading-state {
      text-align: center;
      padding: 60px 20px;
    }
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--aic-border);
      border-top-color: var(--aic-green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      body.has-sidebar { margin-left: 0; }
      .main-content { padding: 20px; }
      .form-row { grid-template-columns: 1fr; }
      .signature-info { grid-template-columns: 1fr; }
      .signed-details-grid { grid-template-columns: 1fr; }
    }

    /* Print styles */
    @media print {
      body { background: white; color: black; margin: 0; }
      .contract-nav, .signature-section, .footer, .status-banner { display: none; }
      .card { background: white; border: 1px solid #ddd; break-inside: avoid; }
      .card h2 { color: #0ECC97; }
    }
  </style>
</head>
<body class="has-sidebar">
  <div class="main-content" id="main-content">
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p style="color: var(--aic-gray);">Carregando contrato...</p>
    </div>
  </div>

  <!-- Client Sidebar -->
  <script src="/components/aic-sidebar.js"></script>

  <script>
    let journeyData = null;
    let clientIP = '0.0.0.0';

    // Get client IP
    async function getClientIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        clientIP = data.ip;
        const ipEl = document.getElementById('sig-ip');
        if (ipEl) ipEl.textContent = clientIP;
      } catch (err) {
        console.error('Erro ao obter IP:', err);
      }
    }

    // Update datetime
    function updateDateTime() {
      const el = document.getElementById('sig-datetime');
      if (!el) return;
      const now = new Date();
      el.textContent = now.toLocaleString('pt-BR', {
        timeZone: 'America/Sao_Paulo',
        day: '2-digit', month: '2-digit', year: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    function formatCurrency(value) {
      return parseFloat(value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    async function init() {
      try {
        const isAdmin = localStorage.getItem('aic_user_role') === 'admin';

        // Admin usa cliente selecionado
        if (isAdmin) {
          await new Promise(r => setTimeout(r, 150));
          const selectedClient = window.getSelectedClient ? window.getSelectedClient() : null;
          if (selectedClient) {
            journeyData = selectedClient;
            renderPage();
            return;
          }
          document.getElementById('content').innerHTML = `
            <div style="text-align: center; padding: 60px; color: #94a3b8;">
              <p>Selecione um cliente no menu lateral para visualizar.</p>
            </div>
          `;
          return;
        }

        // Cliente normal
        const token = localStorage.getItem('aic_client_token');
        if (!token) {
          window.location.href = '/aic/login?redirect=/cliente';
          return;
        }

        const response = await fetch('/api/aic/journey/me', {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('aic_client_token');
            window.location.href = '/aic/login?redirect=/cliente';
            return;
          }
          throw new Error('Erro ao carregar dados');
        }

        journeyData = await response.json();

        // Check if can access this step
        const STEP_ORDER = [
          'proposta_enviada', 'proposta_visualizada', 'contrato_enviado', 'contrato_assinado',
          'pagamento_pendente', 'pagamento_confirmado', 'credenciais_pendente', 'credenciais_ok',
          'briefing_pendente', 'briefing_completo', 'campanha_ativa', 'campanha_concluida'
        ];
        const currentIndex = STEP_ORDER.indexOf(journeyData.current_step);
        if (currentIndex < 1) { // Need at least proposta_visualizada
          window.location.href = '/cliente/proposta';
          return;
        }

        await getClientIP();
        renderPage();
        setInterval(updateDateTime, 1000);

      } catch (error) {
        console.error('Erro:', error);
        document.getElementById('main-content').innerHTML = `
          <div class="loading-state">
            <p style="color: #ef4444;">Erro ao carregar contrato. Por favor, tente novamente.</p>
            <button onclick="location.reload()" class="cta-button" style="margin-top: 16px; background: transparent; border: 1px solid var(--aic-green); color: var(--aic-green);">Tentar Novamente</button>
          </div>
        `;
      }
    }

    function renderPage() {
      const isSigned = ['contrato_assinado', 'pagamento_pendente', 'pagamento_confirmado',
        'credenciais_pendente', 'credenciais_ok', 'briefing_pendente', 'briefing_completo',
        'campanha_ativa', 'campanha_concluida'
      ].includes(journeyData.current_step);

      const contractValue = journeyData.contract_value || 4000;
      const leadValue = journeyData.lead_value || 10;
      const clientName = journeyData.client_name || '';

      document.getElementById('main-content').innerHTML = `
        <!-- Status Banner -->
        <div class="status-banner ${isSigned ? 'signed' : 'pending'}">
          <div class="status-icon">${isSigned ? '&#10003;' : '&#128221;'}</div>
          <div class="status-text">
            <h3>${isSigned ? 'Contrato Assinado' : 'Contrato Pendente de Assinatura'}</h3>
            <p>${isSigned ? 'Voce ja assinou este contrato. Prossiga para o pagamento.' : 'Leia atentamente e assine abaixo para continuar.'}</p>
          </div>
        </div>

        <!-- Navigation -->
        <div class="contract-nav">
          <div class="contract-nav-info">
            Contrato de Prestacao de Servicos AIC
          </div>
          <div class="contract-nav-actions">
            <button class="nav-btn nav-btn-secondary" onclick="window.print()">Imprimir</button>
            ${!isSigned ? '<button class="nav-btn nav-btn-primary" onclick="scrollToSignature()">Ir para Assinatura</button>' : ''}
          </div>
        </div>

        <!-- Header -->
        <div class="page-header">
          <img src="/assets/AIC/Imagens%20Vetor%20/Logo%20Completo%20nome%20Branco%20sem%20fundo.png" alt="AIC" class="logo">
          <h1>Contrato de Prestacao de Servicos</h1>
          <p class="subtitle">Campanha de Prospeccao Ativa e Qualificacao de Leads</p>
          <span class="pill">AIC Applied Intelligence Clustering</span>
        </div>

        <!-- Preambulo -->
        <div class="card">
          <h2>Preambulo</h2>
          <p>Pelo presente instrumento particular de contrato de prestacao de servicos, e na melhor forma de direito, as partes abaixo qualificadas:</p>
          <div class="parties">
            <div class="party">
              <div class="party-label">Contratada</div>
              <div class="party-data">
                <strong>AIC - APPLIED INTELLIGENCE CLUSTERING</strong>, plataforma de prospeccao inteligente e qualificacao de leads, com sede na cidade de Sao Paulo/SP, doravante denominada simplesmente "CONTRATADA" ou "AIC".
              </div>
            </div>
            <div class="party">
              <div class="party-label">Contratante</div>
              <div class="party-data" id="party-contratante">
                ${isSigned && clientName ? `<strong>${clientName}</strong>, doravante denominada "CONTRATANTE".` : '<em>Os dados do contratante serao preenchidos no formulario de assinatura.</em>'}
              </div>
            </div>
          </div>
        </div>

        <!-- Clausula 1 - Objeto -->
        <div class="card">
          <h2>Clausula Primeira - Do Objeto</h2>
          <p><span class="clause-number">1.1.</span> O presente contrato tem por objeto a prestacao de servicos de prospeccao ativa, segmentacao inteligente e qualificacao de leads pela CONTRATADA em favor da CONTRATANTE, utilizando a metodologia proprietaria AIC.</p>
          <p><span class="clause-number">1.2.</span> A campanha tera como objetivo a prospeccao de ate <strong style="color: var(--aic-green);">2.000 perfis publicos</strong> ao longo de 30 dias corridos.</p>
          <div class="warning-box">
            <p><strong>IMPORTANTE:</strong> O numero de 2.000 perfis constitui o OBJETIVO, nao uma garantia de resultados.</p>
          </div>
        </div>

        <!-- Clausula 2 - Metodologia -->
        <div class="card">
          <h2>Clausula Segunda - Da Metodologia</h2>
          <p><span class="clause-number">2.1.</span> A CONTRATADA executara os servicos seguindo a metodologia AIC:</p>
          <ol type="I">
            <li><strong>Diagnostico Estruturado</strong></li>
            <li><strong>Selecao e Validacao de Perfis (AIC Filtering)</strong></li>
            <li><strong>Avaliacao da Landing Page</strong></li>
            <li><strong>Coleta de Materiais de Apoio</strong></li>
            <li><strong>Criacao da Linha Editorial</strong></li>
            <li><strong>Execucao da Campanha</strong></li>
            <li><strong>Qualificacao e Agendamento</strong></li>
          </ol>
        </div>

        <!-- Clausula 3 - Prazos -->
        <div class="card">
          <h2>Clausula Terceira - Dos Prazos</h2>
          <p><span class="clause-number">3.1.</span> O contrato vigorara pelo prazo de 30 dias corridos.</p>
          <table class="contract-table">
            <tr><th>Fase</th><th>Atividades</th><th>Prazo</th></tr>
            <tr><td>Fase 1</td><td>Diagnostico, selecao de perfis, linha editorial</td><td>Dias 1-10</td></tr>
            <tr><td>Fase 2</td><td>Execucao da campanha e envio de mensagens</td><td>Dias 11-25</td></tr>
            <tr><td>Fase 3</td><td>Qualificacao, relatorios e encerramento</td><td>Dias 26-30</td></tr>
          </table>
        </div>

        <!-- Clausula 4 - Investimento -->
        <div class="card">
          <h2>Clausula Quarta - Do Investimento</h2>
          <table class="contract-table">
            <tr><th>Item</th><th>Valor</th><th>Condicao</th></tr>
            <tr><td>Valor Base da Campanha</td><td><strong>${formatCurrency(contractValue)}</strong></td><td>50% no inicio + 50% apos 15 dias</td></tr>
            <tr><td>Valor por Lead Qualificado</td><td><strong>${formatCurrency(leadValue)}</strong> por lead</td><td>Pago ao final</td></tr>
          </table>
          <div class="highlight-box">
            <p><strong>Condicoes de Pagamento:</strong></p>
            <p>1a Parcela: ${formatCurrency(contractValue / 2)} no ato da assinatura</p>
            <p>2a Parcela: ${formatCurrency(contractValue / 2)} apos 15 dias</p>
          </div>
        </div>

        <!-- Clausula 5 - Lead Qualificado -->
        <div class="card">
          <h2>Clausula Quinta - Lead Qualificado</h2>
          <p><span class="clause-number">5.1.</span> Considera-se "Lead Qualificado" o prospecto que:</p>
          <ol type="I">
            <li>Responder demonstrando interesse genuino</li>
            <li>Fornecer contato valido ou agendar conversa</li>
            <li>Apresentar fit com a oferta</li>
          </ol>
          <p><span class="clause-number">5.2.</span> NAO sao leads qualificados: spam, concorrentes, curiosos sem intencao de compra.</p>
          <p><span class="clause-number">5.3.</span> Prazo de contestacao: 5 dias uteis apos entrega do relatorio.</p>
        </div>

        <!-- Clausula 6-8 Resumidas -->
        <div class="card">
          <h2>Clausula Sexta - Expectativas de Resultados</h2>
          <table class="contract-table">
            <tr><th>Metrica</th><th>Projecao</th></tr>
            <tr><td>Contatos enviados</td><td>Ate 2.000</td></tr>
            <tr><td>Taxa de resposta</td><td>10% a 25%</td></tr>
            <tr><td>Leads qualificados</td><td>25 a 120</td></tr>
          </table>
          <div class="warning-box">
            <p><strong>DECLARACAO:</strong> Estes sao PROJECOES baseadas em historico, nao garantias.</p>
          </div>
        </div>

        <div class="card">
          <h2>Clausula Setima - Limites Operacionais</h2>
          <table class="contract-table">
            <tr><th>Plataforma</th><th>Limite Diario</th></tr>
            <tr><td>Instagram (DM)</td><td>80 mensagens</td></tr>
            <tr><td>WhatsApp</td><td>120 mensagens</td></tr>
          </table>
          <p>Envios: segunda a sexta, 9h-18h, horario de Brasilia.</p>
        </div>

        <div class="card">
          <h2>Clausula Oitava - Riscos</h2>
          <p>Riscos inerentes: limitacao ou bloqueio de conta nas plataformas.</p>
          <p>Mitigacao: contas aquecidas, limites rigidos, monitoramento continuo, fallback multi-conta.</p>
        </div>

        <!-- Clausulas 9-16 Resumidas -->
        <div class="card">
          <h2>Clausulas 9 a 16 - Disposicoes Gerais</h2>
          <ul>
            <li><strong>Cl. 9 - Obrigacoes da Contratada:</strong> Executar servicos com zelo, relatorios semanais, opt-out imediato.</li>
            <li><strong>Cl. 10 - Obrigacoes da Contratante:</strong> Fornecer informacoes, manter landing page, efetuar pagamentos.</li>
            <li><strong>Cl. 11 - Escopo:</strong> Inclui prospeccao de 2.000 perfis, criacao de linha editorial, qualificacao. Nao inclui trafego pago ou gestao de redes.</li>
            <li><strong>Cl. 12 - LGPD:</strong> Apenas dados publicos, conformidade com Lei 13.709/2018.</li>
            <li><strong>Cl. 13 - Confidencialidade:</strong> Vigencia de 2 anos apos termino.</li>
            <li><strong>Cl. 14 - Rescisao:</strong> Por mutuo acordo, inadimplemento ou forca maior.</li>
            <li><strong>Cl. 15 - Disposicoes Gerais:</strong> Alteracoes apenas por escrito.</li>
            <li><strong>Cl. 16 - Foro:</strong> Comarca de Sao Paulo/SP.</li>
          </ul>
        </div>

        ${isSigned ? `
          <!-- Already Signed -->
          <div class="signed-section">
            <h3>Contrato Assinado com Sucesso!</h3>
            <p>Este contrato foi assinado eletronicamente.</p>
            <div class="signed-details">
              <div class="signed-details-grid">
                <div class="signed-detail">
                  <div class="signed-detail-label">Nome</div>
                  <div class="signed-detail-value">${journeyData.client_name || '-'}</div>
                </div>
                <div class="signed-detail">
                  <div class="signed-detail-label">Assinado em</div>
                  <div class="signed-detail-value">${journeyData.contrato_assinado_at ? new Date(journeyData.contrato_assinado_at).toLocaleString('pt-BR') : '-'}</div>
                </div>
              </div>
            </div>
            <a href="/cliente/pagamento" class="cta-button">Ir para Pagamento</a>
          </div>
        ` : `
          <!-- Signature Section -->
          <div class="signature-section" id="signature-section">
            <h2>Assinatura Eletronica</h2>
            <p style="color: var(--aic-gray-light); margin-bottom: 24px;">Preencha seus dados e aceite os termos para assinar.</p>

            <form id="contract-form" onsubmit="return submitContract(event)">
              <!-- Dados do Contratante -->
              <div style="background: var(--aic-navy); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <h3 style="color: var(--aic-green); margin-bottom: 16px; font-size: 15px;">Dados do Contratante</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="client_name">Nome Completo / Razao Social *</label>
                    <input type="text" id="client_name" class="form-input" value="${journeyData.client_name || ''}" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="client_document">CPF / CNPJ *</label>
                    <input type="text" id="client_document" class="form-input" value="${journeyData.client_document || ''}" required>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="client_address">Endereco Completo *</label>
                  <input type="text" id="client_address" class="form-input" placeholder="Rua, numero, bairro, cidade, estado, CEP" required>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="client_email">Email *</label>
                    <input type="email" id="client_email" class="form-input" value="${journeyData.client_email || ''}" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="client_phone">Telefone/WhatsApp *</label>
                    <input type="tel" id="client_phone" class="form-input" value="${journeyData.client_phone || ''}" required>
                  </div>
                </div>
              </div>

              <!-- Aceite dos Termos -->
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="term_read" required>
                  <label for="term_read">Declaro que li e compreendi todas as clausulas deste contrato.</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="term_risks" required>
                  <label for="term_risks">Estou ciente dos riscos de restricao ou bloqueio de conta.</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="term_payment" required>
                  <label for="term_payment">Concordo com os valores e forma de pagamento.</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="term_lgpd" required>
                  <label for="term_lgpd">Confirmo conformidade LGPD e opt-out imediato.</label>
                </div>
              </div>

              <!-- Assinatura Digital -->
              <div class="digital-signature-box">
                <h4>Assinatura Digital</h4>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" for="signature_name">Digite seu nome completo para assinar *</label>
                  <input type="text" id="signature_name" class="form-input" placeholder="Seu nome completo" required style="font-size: 18px; text-align: center;">
                  <p class="form-hint">Assinatura eletronica valida conforme MP 2.200-2/2001.</p>
                </div>
                <div class="signature-info">
                  <div class="signature-info-item">
                    <div class="signature-info-label">Data/Hora</div>
                    <div class="signature-info-value" id="sig-datetime">--</div>
                  </div>
                  <div class="signature-info-item">
                    <div class="signature-info-label">IP</div>
                    <div class="signature-info-value" id="sig-ip">${clientIP}</div>
                  </div>
                </div>
              </div>

              <!-- Submit -->
              <div style="text-align: center; margin-top: 24px;">
                <button type="submit" class="cta-button" id="btn-sign">
                  Assinar Contrato Eletronicamente
                </button>
              </div>

              <div id="contract-status" class="status-message"></div>
            </form>
          </div>
        `}

        <!-- Footer -->
        <div class="footer">
          <p>Documento confidencial AIC. &copy; 2025 Applied Intelligence Clustering.</p>
        </div>
      `;

      // Start datetime update after render
      updateDateTime();
    }

    function scrollToSignature() {
      document.getElementById('signature-section').scrollIntoView({ behavior: 'smooth' });
    }

    function showStatus(elementId, message, type) {
      const el = document.getElementById(elementId);
      if (!el) return;
      el.textContent = message;
      el.className = `status-message show ${type}`;
    }

    async function submitContract(event) {
      event.preventDefault();

      const btn = document.getElementById('btn-sign');
      const signatureName = document.getElementById('signature_name').value.trim();

      if (!signatureName) {
        showStatus('contract-status', 'Digite seu nome completo para assinar.', 'error');
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Processando...';
      showStatus('contract-status', 'Assinando contrato...', 'loading');

      try {
        const token = localStorage.getItem('aic_client_token');
        const response = await fetch('/api/aic/journey/sign-contract', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            client_name: document.getElementById('client_name').value.trim(),
            client_document: document.getElementById('client_document').value.trim(),
            client_address: document.getElementById('client_address').value.trim(),
            client_email: document.getElementById('client_email').value.trim(),
            client_phone: document.getElementById('client_phone').value.trim(),
            signature_name: signatureName,
            signature_ip: clientIP,
            signature_user_agent: navigator.userAgent
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Erro ao assinar contrato');
        }

        showStatus('contract-status', 'Contrato assinado com sucesso! Redirecionando...', 'success');

        setTimeout(() => {
          window.location.href = '/cliente/pagamento';
        }, 2000);

      } catch (error) {
        console.error('Erro:', error);
        showStatus('contract-status', error.message || 'Erro ao assinar. Tente novamente.', 'error');
        btn.disabled = false;
        btn.textContent = 'Assinar Contrato Eletronicamente';
      }
    }

    // Initialize
    init();
  </script>
</body>
</html>
